25-07-30.00:22:09.728 [main            ] INFO  RaffleOrderTest        - Starting RaffleOrderTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 27980 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-30.00:22:09.730 [main            ] INFO  RaffleOrderTest        - The following 1 profile is active: "dev"
25-07-30.00:22:10.925 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-30.00:22:10.927 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-30.00:22:10.959 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 21 ms. Found 0 Redis repository interfaces.
25-07-30.00:22:12.477 [main            ] INFO  Version                - Redisson 3.23.4
25-07-30.00:22:12.798 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.00:22:12.808 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.00:22:15.060 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-30.00:22:15.113 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-30.00:22:15.167 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#6f986501:0/SimpleConnection@14d1032a [delegate=amqp://admin@127.0.0.1:5672/, localPort= 13000]
25-07-30.00:22:15.249 [main            ] INFO  RaffleOrderTest        - Started RaffleOrderTest in 5.811 seconds (JVM running for 6.447)
25-07-30.00:22:15.425 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.00:22:15.631 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.00:22:15.711 [main            ] INFO  RaffleOrderTest        - 装配活动：true
25-07-30.00:22:15.721 [main            ] INFO  ActivityBaseActionChain - 活动责任链-基础信息【有效期、状态、库存(sku)】校验开始。sku:9011 activityId:100301
25-07-30.00:22:15.721 [main            ] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【校验&扣减】开始。
25-07-30.00:22:15.726 [main            ] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【有效期、状态、库存（sku）】成功。sku：9011 activityId:100301
25-07-30.00:22:15.765 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.00:22:15.874 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.00:22:15.916 [main            ] INFO  RaffleOrderTest        - 测试结果：846871150361
25-07-30.00:22:15.930 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:22:15.931 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:22:15.933 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:22:16.229 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:22:16.229 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:22:16.241 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:22:16.244 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.00:22:16.244 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.00:22:16.244 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.00:30:52.238 [main            ] INFO  RaffleOrderTest        - Starting RaffleOrderTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 29876 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-30.00:30:52.239 [main            ] INFO  RaffleOrderTest        - The following 1 profile is active: "dev"
25-07-30.00:30:53.042 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-30.00:30:53.044 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-30.00:30:53.073 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 0 Redis repository interfaces.
25-07-30.00:30:54.148 [main            ] INFO  Version                - Redisson 3.23.4
25-07-30.00:30:54.478 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.00:30:54.489 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.00:30:56.779 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-30.00:30:56.838 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-30.00:30:56.886 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#6f986501:0/SimpleConnection@14d1032a [delegate=amqp://admin@127.0.0.1:5672/, localPort= 13185]
25-07-30.00:30:56.961 [main            ] INFO  RaffleOrderTest        - Started RaffleOrderTest in 5.0 seconds (JVM running for 5.574)
25-07-30.00:30:57.131 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.00:30:57.327 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.00:30:57.501 [main            ] INFO  RaffleOrderTest        - 装配活动：true
25-07-30.00:30:57.538 [main            ] INFO  ActivityBaseActionChain - 活动责任链-基础信息【有效期、状态、库存(sku)】校验开始。sku:9011 activityId:100301
25-07-30.00:30:57.538 [main            ] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【校验&扣减】开始。
25-07-30.00:30:57.541 [main            ] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【有效期、状态、库存（sku）】成功。sku：9011 activityId:100301
25-07-30.00:30:57.564 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.00:30:57.584 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.00:30:57.603 [main            ] INFO  RaffleOrderTest        - 测试结果：617186509463
25-07-30.00:30:57.617 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:30:57.619 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:30:57.620 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:30:57.947 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:30:57.947 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:30:57.960 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:30:57.963 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.00:30:57.963 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.00:30:57.963 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.00:32:21.535 [main            ] INFO  CreditAdjustServiceTest - Starting CreditAdjustServiceTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 6840 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-30.00:32:21.536 [main            ] INFO  CreditAdjustServiceTest - The following 1 profile is active: "dev"
25-07-30.00:32:22.214 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-30.00:32:22.216 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-30.00:32:22.245 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 Redis repository interfaces.
25-07-30.00:32:23.275 [main            ] INFO  Version                - Redisson 3.23.4
25-07-30.00:32:23.590 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.00:32:23.601 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.00:32:25.763 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-30.00:32:25.819 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-30.00:32:25.876 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#6eeb29c0:0/SimpleConnection@425f94d7 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 13308]
25-07-30.00:32:25.952 [main            ] INFO  CreditAdjustServiceTest - Started CreditAdjustServiceTest in 4.71 seconds (JVM running for 5.246)
25-07-30.00:32:26.129 [main            ] INFO  CreditAdjustService    - 增加账户积分额度开始 userId:xiaofuge tradeName:CONVERT_SKU amount:-1.68
25-07-30.00:32:26.275 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.00:32:26.466 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.00:32:26.541 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:credit_adjust_success message:{"data":{"amount":-1.68,"orderId":"558647719288","outBusinessNo":"70009240609003","userId":"xiaofuge"},"id":"53879186533","timestamp":1753806746131}
25-07-30.00:32:26.559 [main            ] INFO  CreditRepository       - 调整账户积分记录，发送MQ消息完成 userId: xiaofuge orderId:558647719288 topic: credit_adjust_success
25-07-30.00:32:26.559 [main            ] INFO  CreditAdjustService    - 账户积分额度完成 userId:xiaofuge orderId:558647719288
25-07-30.00:32:30.013 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.00:32:30.027 [scheduling-1    ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.00:32:30.053 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.00:32:30.056 [scheduling-1    ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.00:33:50.940 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:33:50.942 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:33:50.943 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:33:51.777 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:33:51.820 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:33:51.820 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:33:51.823 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.00:33:51.823 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.00:33:51.827 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.00:33:55.227 [main            ] INFO  CreditAdjustServiceTest - Starting CreditAdjustServiceTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 26248 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-30.00:33:55.233 [main            ] INFO  CreditAdjustServiceTest - The following 1 profile is active: "dev"
25-07-30.00:33:56.017 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-30.00:33:56.019 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-30.00:33:56.051 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 23 ms. Found 0 Redis repository interfaces.
25-07-30.00:33:57.080 [main            ] INFO  Version                - Redisson 3.23.4
25-07-30.00:33:57.405 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.00:33:57.417 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.00:33:59.677 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-30.00:33:59.738 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-30.00:33:59.785 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#22ca1242:0/SimpleConnection@414e8b31 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 13483]
25-07-30.00:33:59.892 [main            ] INFO  CreditAdjustServiceTest - Started CreditAdjustServiceTest in 4.977 seconds (JVM running for 5.531)
25-07-30.00:34:00.028 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.00:34:00.028 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.00:34:00.050 [main            ] INFO  CreditAdjustService    - 增加账户积分额度开始 userId:xiaofuge tradeName:CONVERT_SKU amount:-1.68
25-07-30.00:34:00.234 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.00:34:00.234 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.00:34:00.296 [main            ] ERROR CreditRepository       - 调整账户积分额度异常，唯一索引冲突 userId:xiaofuge orderId:931947661419
org.springframework.dao.DuplicateKeyException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry '70009240609003' for key 'user_credit_order_001.uq_out_business_no'
### The error may exist in file [D:\DevTool\Java\java_pro\ddd\big-market\big-market-app\target\classes\mybatis\mapper\user_credit_order_mapper.xml]
### The error may involve com.lin.infrastructure.persistent.dao.IUserCreditOrderDao.insert-Inline
### The error occurred while setting parameters
### SQL: insert into user_credit_order_001(user_id, order_id, trade_name, trade_type, trade_amount, out_business_no, create_time, update_time)         values(         ?,?,?,?,?,?,now(),now()         )
### Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry '70009240609003' for key 'user_credit_order_001.uq_out_business_no'
; Duplicate entry '70009240609003' for key 'user_credit_order_001.uq_out_business_no'; nested exception is java.sql.SQLIntegrityConstraintViolationException: Duplicate entry '70009240609003' for key 'user_credit_order_001.uq_out_business_no'
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:247)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy109.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy149.insert(Unknown Source)
	at com.lin.infrastructure.persistent.repository.CreditRepository.lambda$saveUserCreditTradeOrder$0(CreditRepository.java:97)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
	at com.lin.infrastructure.persistent.repository.CreditRepository.saveUserCreditTradeOrder(CreditRepository.java:87)
	at com.lin.infrastructure.persistent.repository.CreditRepository$$FastClassBySpringCGLIB$$24475b71.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at com.lin.infrastructure.persistent.repository.CreditRepository$$EnhancerBySpringCGLIB$$30bd4faf.saveUserCreditTradeOrder(<generated>)
	at com.lin.domain.credit.service.CreditAdjustService.createOrder(CreditAdjustService.java:65)
	at com.lin.test.domain.credit.CreditAdjustServiceTest.test_createOrder_pay(CreditAdjustServiceTest.java:60)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry '70009240609003' for key 'user_credit_order_001.uq_out_business_no'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy207.update(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 54 common frames omitted
25-07-30.00:34:00.308 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:credit_adjust_success message:{"data":{"amount":-1.68,"orderId":"931947661419","outBusinessNo":"70009240609003","userId":"xiaofuge"},"id":"98920246247","timestamp":1753806840053}
25-07-30.00:34:00.317 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  CreditAdjustSuccessCustomer - 监听积分账户调整成功消息，进行交易商品发货 topic: credit_adjust_success message: {"data":{"amount":-1.68,"orderId":"931947661419","outBusinessNo":"70009240609003","userId":"xiaofuge"},"id":"98920246247","timestamp":1753806840053}
25-07-30.00:34:00.319 [main            ] INFO  CreditRepository       - 调整账户积分记录，发送MQ消息完成 userId: xiaofuge orderId:931947661419 topic: credit_adjust_success
25-07-30.00:34:00.319 [main            ] INFO  CreditAdjustService    - 账户积分额度完成 userId:xiaofuge orderId:931947661419
25-07-30.00:35:10.902 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:35:10.904 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:35:10.907 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:35:10.909 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.00:35:11.085 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:35:11.672 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:35:11.672 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:35:11.680 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.00:35:11.693 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.00:35:11.694 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.00:35:11.694 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.00:35:11.694 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:10:14.196 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 9044 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-30.23:10:14.205 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-30.23:10:17.842 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-30.23:10:17.843 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-30.23:10:17.881 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 23 ms. Found 0 Redis repository interfaces.
25-07-30.23:10:19.171 [main            ] INFO  Version                - Redisson 3.23.4
25-07-30.23:10:19.528 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.23:10:19.541 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.23:10:22.230 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-30.23:10:22.294 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-30.23:10:22.374 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#4b544732:0/SimpleConnection@2586e878 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 9234]
25-07-30.23:10:22.455 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 8.626 seconds (JVM running for 9.489)
25-07-30.23:10:22.662 [main            ] INFO  RaffleActivityController - 查询sku商品集合开始 activityId:100301
25-07-30.23:10:22.678 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.23:10:22.908 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.23:10:23.116 [main            ] INFO  RaffleActivityController - 查询sku商品集合完成 activityId:100301 skuProductResponseDTOS:[{"activityCount":{"dayCount":100,"monthCount":100,"totalCount":100},"activityCountId":11101,"productAmount":1.68,"sku":9011,"stockCount":100000,"stockCountSurplus":99890}]
25-07-30.23:10:23.117 [main            ] INFO  RaffleActivityControllerTest - 请求参数：100301
25-07-30.23:10:23.120 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":[{"activityCount":{"dayCount":100,"monthCount":100,"totalCount":100},"activityCountId":11101,"productAmount":1.68,"sku":9011,"stockCount":100000,"stockCountSurplus":99890}],"info":"成功"}
25-07-30.23:10:23.133 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:10:23.135 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:10:23.137 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:10:23.138 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:10:23.428 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:10:23.442 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:10:23.442 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:10:23.459 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:10:23.461 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:10:23.462 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:10:23.462 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:10:23.462 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:13:03.662 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 20000 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-30.23:13:03.669 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-30.23:13:04.361 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-30.23:13:04.361 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-30.23:13:04.406 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 22 ms. Found 0 Redis repository interfaces.
25-07-30.23:13:05.407 [main            ] INFO  Version                - Redisson 3.23.4
25-07-30.23:13:05.733 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.23:13:05.744 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.23:13:07.913 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-30.23:13:07.973 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-30.23:13:08.020 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#4b544732:0/SimpleConnection@2586e878 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 9383]
25-07-30.23:13:08.113 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.823 seconds (JVM running for 5.433)
25-07-30.23:13:08.269 [main            ] INFO  RaffleActivityController - 查询用户积分值开始 userId:xiaofuge
25-07-30.23:13:08.293 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.23:13:08.482 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.23:13:08.513 [main            ] INFO  RaffleActivityController - 查询用户积分值完成 userId:xiaofuge adjustAmount:84.17
25-07-30.23:13:08.604 [main            ] INFO  RaffleActivityControllerTest - 请求参数："xiaofuge"
25-07-30.23:13:08.618 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":84.17,"info":"成功"}
25-07-30.23:13:08.633 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:13:08.635 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:13:08.638 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:13:08.640 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:13:09.093 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:13:09.093 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:13:09.107 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:13:09.107 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:13:09.110 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:13:09.110 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:13:09.110 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:13:09.110 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:13:18.539 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 14148 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-30.23:13:18.542 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-30.23:13:19.266 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-30.23:13:19.271 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-30.23:13:19.298 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 Redis repository interfaces.
25-07-30.23:13:20.291 [main            ] INFO  Version                - Redisson 3.23.4
25-07-30.23:13:20.598 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.23:13:20.607 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.23:13:23.048 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-30.23:13:23.102 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-30.23:13:23.147 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#4b544732:0/SimpleConnection@2586e878 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 9475]
25-07-30.23:13:23.238 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 5.033 seconds (JVM running for 5.575)
25-07-30.23:13:23.398 [main            ] INFO  RaffleActivityController - 积分兑换商品开始 userId:xiaofuge sku:9011
25-07-30.23:13:23.432 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.23:13:23.628 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.23:13:23.656 [main            ] INFO  RaffleActivityController - 积分兑换商品，创建订单完成 userId:xiaofuge sku:9011 outBusinessNo:70009240609002
25-07-30.23:13:23.656 [main            ] ERROR RaffleActivityController - 积分兑换商品失败 userId:xiaofuge sku:9011
java.lang.NullPointerException: null
	at com.lin.trigger.http.RaffleActivityController.creditPayExchangeSku(RaffleActivityController.java:391)
	at com.lin.test.trigger.RaffleActivityControllerTest.test_creditPayExchangeSku(RaffleActivityControllerTest.java:110)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)
25-07-30.23:13:23.774 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"sku":9011,"userId":"xiaofuge"}
25-07-30.23:13:23.778 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0001","data":false,"info":"未知失败"}
25-07-30.23:13:25.009 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.23:13:25.026 [scheduling-1    ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.23:13:25.047 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.23:13:25.058 [scheduling-1    ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.23:17:25.100 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:17:25.102 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:17:25.103 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:17:25.105 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:17:25.857 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:17:25.930 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:17:25.931 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:17:25.931 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:17:25.934 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:17:25.934 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:17:25.934 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:17:25.934 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:18:41.213 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 13336 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-30.23:18:41.213 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-30.23:18:42.018 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-30.23:18:42.018 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-30.23:18:42.058 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 21 ms. Found 0 Redis repository interfaces.
25-07-30.23:18:43.222 [main            ] INFO  Version                - Redisson 3.23.4
25-07-30.23:18:43.555 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.23:18:43.566 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.23:18:46.032 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-30.23:18:46.097 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-30.23:18:46.147 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#2ef1fc8a:0/SimpleConnection@39a1c200 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 9620]
25-07-30.23:18:46.211 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 5.316 seconds (JVM running for 6.453)
25-07-30.23:18:50.117 [main            ] INFO  RaffleActivityController - 积分兑换商品开始 userId:xiaofuge sku:9011
25-07-30.23:18:57.901 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.23:18:57.971 [pool-3-thread-3 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.23:18:58.202 [pool-3-thread-3 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.23:18:58.436 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.23:23:27.677 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=4m59s240ms795µs300ns).
25-07-30.23:23:27.677 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=4m29s364ms536µs900ns).
25-07-30.23:25:32.194 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=2m4s521ms894µs500ns).
25-07-30.23:25:32.199 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=2m4s522ms13µs300ns).
25-07-30.23:25:32.199 [main            ] INFO  RaffleActivityController - 积分兑换商品，创建订单完成 userId:xiaofuge sku:9011 outBusinessNo:70009240609002
25-07-30.23:25:32.215 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  SimpleMessageListenerContainer - Restarting Consumer@6715a6da: tags=[[amq.ctag-T_8kc-mXbYzZT7H6Ot5Btw]], channel=Cached Rabbit Channel: AMQChannel(amqp://admin@127.0.0.1:5672/,2), conn: Proxy@55589ef5 Shared Rabbit Connection: SimpleConnection@39a1c200 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 9620], acknowledgeMode=AUTO local queue size=0
25-07-30.23:25:32.215 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SimpleMessageListenerContainer - Restarting Consumer@29f86630: tags=[[amq.ctag-hWgkoZtij4bMGodPJl0wSw]], channel=Cached Rabbit Channel: AMQChannel(amqp://admin@127.0.0.1:5672/,3), conn: Proxy@55589ef5 Shared Rabbit Connection: SimpleConnection@39a1c200 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 9620], acknowledgeMode=AUTO local queue size=0
25-07-30.23:25:32.215 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  SimpleMessageListenerContainer - Restarting Consumer@7bdaf563: tags=[[amq.ctag-mgkZgU97M2PiU8FGRs3BJw]], channel=Cached Rabbit Channel: AMQChannel(amqp://admin@127.0.0.1:5672/,1), conn: Proxy@55589ef5 Shared Rabbit Connection: SimpleConnection@39a1c200 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 9620], acknowledgeMode=AUTO local queue size=0
25-07-30.23:25:32.217 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-1] INFO  SimpleMessageListenerContainer - Restarting Consumer@4c51fc9a: tags=[[amq.ctag-dAsk9IyD9TJNj0phtfAWQw]], channel=Cached Rabbit Channel: AMQChannel(amqp://admin@127.0.0.1:5672/,4), conn: Proxy@55589ef5 Shared Rabbit Connection: SimpleConnection@39a1c200 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 9620], acknowledgeMode=AUTO local queue size=0
25-07-30.23:25:32.229 [main            ] ERROR RaffleActivityController - 积分兑换商品失败 userId:xiaofuge sku:9011
java.lang.NullPointerException: null
	at com.lin.trigger.http.RaffleActivityController.creditPayExchangeSku(RaffleActivityController.java:391)
	at com.lin.test.trigger.RaffleActivityControllerTest.test_creditPayExchangeSku(RaffleActivityControllerTest.java:110)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)
25-07-30.23:25:32.240 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-30.23:25:32.265 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-3] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:25:32.265 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-3] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:25:32.265 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-3] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:25:32.265 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-3] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:25:32.266 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-3] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:25:32.266 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-3] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:25:32.265 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-3] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:25:32.266 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-3] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:25:32.279 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#2ef1fc8a:1/SimpleConnection@3d5121f [delegate=amqp://admin@127.0.0.1:5672/, localPort= 9699]
25-07-30.23:25:32.280 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:25:32.284 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:25:32.285 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:25:32.285 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:25:32.310 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-2] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-30.23:25:32.324 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-2] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#2ef1fc8a:2/SimpleConnection@50d0b81 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 9703]
25-07-30.23:25:32.329 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"sku":9011,"userId":"xiaofuge"}
25-07-30.23:25:32.346 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0001","data":false,"info":"未知失败"}
25-07-30.23:25:34.738 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 15828 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-30.23:25:34.744 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-30.23:25:35.405 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-30.23:25:35.405 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-30.23:25:35.433 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 Redis repository interfaces.
25-07-30.23:25:36.403 [main            ] INFO  Version                - Redisson 3.23.4
25-07-30.23:25:36.666 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.23:25:36.677 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-30.23:25:38.992 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-30.23:25:39.057 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-30.23:25:39.112 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#4b544732:0/SimpleConnection@2586e878 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 9781]
25-07-30.23:25:39.196 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.738 seconds (JVM running for 5.289)
25-07-30.23:25:39.358 [main            ] INFO  RaffleActivityController - 积分兑换商品开始 userId:xiaofuge sku:9011
25-07-30.23:25:39.388 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.23:25:39.609 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.23:25:39.624 [main            ] INFO  RaffleActivityController - 积分兑换商品，创建订单完成 userId:xiaofuge sku:9011 outBusinessNo:70009240609002
25-07-30.23:25:39.634 [main            ] INFO  CreditAdjustService    - 增加账户积分额度开始 userId:xiaofuge tradeName:CONVERT_SKU amount:-1.68
25-07-30.23:25:39.799 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:credit_adjust_success message:{"data":{"amount":-1.68,"orderId":"539008434882","outBusinessNo":"70009240609002","userId":"xiaofuge"},"id":"40031583103","timestamp":1753889139634}
25-07-30.23:25:39.807 [main            ] INFO  CreditRepository       - 调整账户积分记录，发送MQ消息完成 userId: xiaofuge orderId:539008434882 topic: credit_adjust_success
25-07-30.23:25:39.807 [main            ] INFO  CreditAdjustService    - 账户积分额度完成 userId:xiaofuge orderId:539008434882
25-07-30.23:25:39.807 [main            ] INFO  RaffleActivityController - 积分兑换商品，支付订单完成  userId:xiaofuge sku:9011 orderId:539008434882
25-07-30.23:25:39.808 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  CreditAdjustSuccessCustomer - 监听积分账户调整成功消息，进行交易商品发货 topic: credit_adjust_success message: {"data":{"amount":-1.68,"orderId":"539008434882","outBusinessNo":"70009240609002","userId":"xiaofuge"},"id":"40031583103","timestamp":1753889139634}
25-07-30.23:25:39.810 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"sku":9011,"userId":"xiaofuge"}
25-07-30.23:25:39.812 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":true,"info":"成功"}
25-07-30.23:25:40.019 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-30.23:25:40.040 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-30.23:42:51.686 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:42:51.689 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:42:51.691 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:42:51.692 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-30.23:42:51.753 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:42:52.122 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#3-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:42:52.128 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:42:52.440 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-30.23:42:52.440 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:42:52.440 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:42:52.440 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-30.23:42:52.440 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
