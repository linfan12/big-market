25-07-29.00:04:47.945 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 30172 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.00:04:47.951 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.00:04:48.619 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.00:04:48.622 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.00:04:48.648 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 Redis repository interfaces.
25-07-29.00:04:49.792 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.00:04:50.140 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.00:04:50.151 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.00:04:52.491 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.00:04:52.543 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.00:04:52.585 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#41ece227:0/SimpleConnection@29ccab93 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 13246]
25-07-29.00:04:52.638 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 topic: send_rebate message: {"data":{"bizId":"xiaofuge1_integral_20250728","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge1"},"id":"19058570921","timestamp":1753718085070}
25-07-29.00:04:52.653 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.997 seconds (JVM running for 5.556)
25-07-29.00:04:52.769 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 - 非sku奖励暂时不处理 topic: send_rebate message: {"data":{"bizId":"xiaofuge1_integral_20250728","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge1"},"id":"19058570921","timestamp":1753718085070}
25-07-29.00:04:52.809 [main            ] INFO  RaffleActivityController - 日历签到返利开始 userId:xiaofuge2
25-07-29.00:04:52.820 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.00:04:53.009 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.00:04:53.035 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.00:04:53.060 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.00:04:53.105 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge2_sku_20250729","rebateConfig":"9011","rebateType":"sku","userId":"xiaofuge2"},"id":"61890168742","timestamp":1753718693031}
25-07-29.00:04:53.106 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 topic: send_rebate message: {"data":{"bizId":"xiaofuge2_sku_20250729","rebateConfig":"9011","rebateType":"sku","userId":"xiaofuge2"},"id":"61890168742","timestamp":1753718693031}
25-07-29.00:04:53.122 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge2_integral_20250729","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge2"},"id":"40001967804","timestamp":1753718693031}
25-07-29.00:04:53.132 [main            ] INFO  RaffleActivityController - 日历签到返利完成 userId:xiaofuge2 orderIds: ["107600003154","538893284449"]
25-07-29.00:04:53.135 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":true,"info":"成功"}
25-07-29.00:04:53.151 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:04:53.152 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:04:53.153 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:04:53.177 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivityBaseActionChain - 活动责任链-基础信息【有效期、状态、库存(sku)】校验开始。sku:9011 activityId:100301
25-07-29.00:04:53.177 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【校验&扣减】开始。
25-07-29.00:04:53.182 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【有效期、状态、库存（sku）】成功。sku：9011 activityId:100301
25-07-29.00:04:53.257 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:04:53.660 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:04:53.661 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:04:53.663 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:04:53.664 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:04:53.664 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:17:46.388 [main            ] INFO  RaffleStrategyControllerTest - Starting RaffleStrategyControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 23784 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.00:17:46.390 [main            ] INFO  RaffleStrategyControllerTest - The following 1 profile is active: "dev"
25-07-29.00:17:47.150 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.00:17:47.151 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.00:17:47.181 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 Redis repository interfaces.
25-07-29.00:17:48.282 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.00:17:48.597 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.00:17:48.608 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.00:17:51.020 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.00:17:51.073 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.00:17:51.118 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#41ece227:0/SimpleConnection@73a116d [delegate=amqp://admin@127.0.0.1:5672/, localPort= 13981]
25-07-29.00:17:51.181 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 topic: send_rebate message: {"data":{"bizId":"xiaofuge2_integral_20250729","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge2"},"id":"40001967804","timestamp":1753718693031}
25-07-29.00:17:51.207 [main            ] INFO  RaffleStrategyControllerTest - Started RaffleStrategyControllerTest in 5.098 seconds (JVM running for 5.687)
25-07-29.00:17:51.322 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 - 非sku奖励暂时不处理 topic: send_rebate message: {"data":{"bizId":"xiaofuge2_integral_20250729","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge2"},"id":"40001967804","timestamp":1753718693031}
25-07-29.00:17:51.369 [main            ] INFO  RaffleStrategyController - 查询抽奖策略权重规则配置开始 userId:xiaofuge activityId：100301
25-07-29.00:17:51.399 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.00:17:51.583 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.00:17:51.607 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.00:17:51.630 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.00:17:51.776 [main            ] INFO  RaffleStrategyController - 查询抽奖策略权重规则配置完成 userId:xiaofuge activityId：100301 response: {"code":"0000","data":[{"ruleWeightCount":4000,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"},{"awardId":103,"awardTitle":"支付优惠券"},{"awardId":104,"awardTitle":"小米台灯"},{"awardId":105,"awardTitle":"小米su7周体验"}],"userActivityAccountTotalUseCount":8862},{"ruleWeightCount":60,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"}],"userActivityAccountTotalUseCount":8862},{"ruleWeightCount":5000,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"},{"awardId":103,"awardTitle":"支付优惠券"},{"awardId":104,"awardTitle":"小米台灯"},{"awardId":105,"awardTitle":"小米su7周体验"},{"awardId":106,"awardTitle":"轻奢办公椅"},{"awardId":107,"awardTitle":"小霸王游戏机"}],"userActivityAccountTotalUseCount":8862},{"ruleWeightCount":6000,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"},{"awardId":103,"awardTitle":"支付优惠券"},{"awardId":104,"awardTitle":"小米台灯"},{"awardId":105,"awardTitle":"小米su7周体验"},{"awardId":106,"awardTitle":"轻奢办公椅"},{"awardId":107,"awardTitle":"小霸王游戏机"},{"awardId":108,"awardTitle":"暴走玩偶"}],"userActivityAccountTotalUseCount":8862}],"info":"成功"}
25-07-29.00:17:51.777 [main            ] INFO  RaffleStrategyControllerTest - 请求参数：{"activityId":100301,"userId":"xiaofuge"}
25-07-29.00:17:51.777 [main            ] INFO  RaffleStrategyControllerTest - 测试结果：{"code":"0000","data":[{"ruleWeightCount":4000,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"},{"awardId":103,"awardTitle":"支付优惠券"},{"awardId":104,"awardTitle":"小米台灯"},{"awardId":105,"awardTitle":"小米su7周体验"}],"userActivityAccountTotalUseCount":8862},{"ruleWeightCount":60,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"}],"userActivityAccountTotalUseCount":8862},{"ruleWeightCount":5000,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"},{"awardId":103,"awardTitle":"支付优惠券"},{"awardId":104,"awardTitle":"小米台灯"},{"awardId":105,"awardTitle":"小米su7周体验"},{"awardId":106,"awardTitle":"轻奢办公椅"},{"awardId":107,"awardTitle":"小霸王游戏机"}],"userActivityAccountTotalUseCount":8862},{"ruleWeightCount":6000,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"},{"awardId":103,"awardTitle":"支付优惠券"},{"awardId":104,"awardTitle":"小米台灯"},{"awardId":105,"awardTitle":"小米su7周体验"},{"awardId":106,"awardTitle":"轻奢办公椅"},{"awardId":107,"awardTitle":"小霸王游戏机"},{"awardId":108,"awardTitle":"暴走玩偶"}],"userActivityAccountTotalUseCount":8862}],"info":"成功"}
25-07-29.00:17:51.795 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:17:51.797 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:17:51.798 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:17:52.182 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:17:52.194 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:17:52.333 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:17:52.336 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:17:52.336 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:17:52.336 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:21:03.852 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 12904 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.00:21:03.860 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.00:21:04.520 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.00:21:04.520 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.00:21:04.549 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 Redis repository interfaces.
25-07-29.00:21:05.543 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.00:21:05.814 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.00:21:05.825 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.00:21:07.972 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.00:21:08.035 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.00:21:08.082 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#41ece227:0/SimpleConnection@34f60be9 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 14295]
25-07-29.00:21:08.167 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.597 seconds (JVM running for 5.121)
25-07-29.00:21:08.323 [main            ] INFO  RaffleActivityController - 活动抽奖 userId:xiaofuge activityId:100301
25-07-29.00:21:08.396 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.00:21:08.576 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.00:21:08.639 [main            ] INFO  RaffleActivityController - 活动抽奖，创建订单 userId:xiaofuge activityId:100301 orderId:269989825843
25-07-29.00:21:08.646 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.00:21:08.666 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.00:21:08.682 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:xiaofuge strategyId:100006 ruleModel:rule_blacklist
25-07-29.00:21:08.698 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单放行 userId:xiaofuge strategyId:100006 ruleModel:rule_blacklist
25-07-29.00:21:08.699 [main            ] INFO  RuleWeightLogicChain   - 抽奖责任链-权重开始 userId:xiaofuge strategyId:100006 ruleModel:rule_weight
25-07-29.00:21:08.712 [main            ] ERROR RaffleActivityController - 活动抽奖失败 userId:xiaofuge activityId:100301
com.lin.types.exception.AppException: null
	at com.lin.infrastructure.persistent.repository.StrategyRepository.getRateRange(StrategyRepository.java:111)
	at com.lin.infrastructure.persistent.repository.StrategyRepository$$FastClassBySpringCGLIB$$17e2a7eb.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at com.lin.infrastructure.persistent.repository.StrategyRepository$$EnhancerBySpringCGLIB$$3e4599e9.getRateRange(<generated>)
	at com.lin.domain.strategy.service.armory.StrategyArmoryDispatch.getRandomAwardId(StrategyArmoryDispatch.java:147)
	at com.lin.domain.strategy.service.rule.chain.Impl.RuleWeightLogicChain.logic(RuleWeightLogicChain.java:60)
	at com.lin.domain.strategy.service.rule.chain.Impl.BackListLogicChain.logic(BackListLogicChain.java:43)
	at com.lin.domain.strategy.service.raffle.DefaultRaffleStrategy.raffleLogicChain(DefaultRaffleStrategy.java:38)
	at com.lin.domain.strategy.service.AbstractRaffleStrategy.performRaffle(AbstractRaffleStrategy.java:49)
	at com.lin.trigger.http.RaffleActivityController.draw(RaffleActivityController.java:136)
	at com.lin.test.trigger.RaffleActivityControllerTest.test_draw(RaffleActivityControllerTest.java:42)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)
25-07-29.00:21:08.847 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"xiaofuge"}
25-07-29.00:21:08.850 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"ERR_BIZ_002","info":"big_market_strategy_rate_range_key_100006_60:102:抽奖策略配置未装配，请通过IStrategyArmory完成装配"}
25-07-29.00:21:08.878 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:21:08.879 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:21:08.880 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:21:09.147 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:21:09.156 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:21:09.156 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:21:09.160 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:21:09.160 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:21:09.160 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:21:23.269 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 29664 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.00:21:23.269 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.00:21:23.949 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.00:21:23.951 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.00:21:23.978 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 Redis repository interfaces.
25-07-29.00:21:25.135 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.00:21:25.552 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.00:21:25.573 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.00:21:27.908 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.00:21:27.961 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.00:21:28.006 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#41ece227:0/SimpleConnection@34f60be9 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 14426]
25-07-29.00:21:28.080 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 5.12 seconds (JVM running for 5.669)
25-07-29.00:21:28.239 [main            ] INFO  RaffleActivityController - 活动装配，数据预热，开始 activityId:100301
25-07-29.00:21:28.259 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.00:21:28.432 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.00:21:28.579 [main            ] INFO  RaffleActivityController - 活动装配，数据预热，完成 activityId:100301
25-07-29.00:21:28.698 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":true,"info":"成功"}
25-07-29.00:21:28.713 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:21:28.714 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:21:28.716 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:21:29.069 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:21:29.070 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:21:29.076 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:21:29.080 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:21:29.080 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:21:29.080 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:21:31.567 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 23416 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.00:21:31.568 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.00:21:32.225 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.00:21:32.228 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.00:21:32.254 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 0 Redis repository interfaces.
25-07-29.00:21:33.230 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.00:21:33.541 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.00:21:33.551 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.00:21:35.639 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.00:21:35.689 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.00:21:35.730 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#41ece227:0/SimpleConnection@73a116d [delegate=amqp://admin@127.0.0.1:5672/, localPort= 14518]
25-07-29.00:21:35.805 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.518 seconds (JVM running for 5.038)
25-07-29.00:21:35.969 [main            ] INFO  RaffleActivityController - 活动抽奖 userId:xiaofuge activityId:100301
25-07-29.00:21:36.041 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.00:21:36.232 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.00:21:36.369 [main            ] INFO  AbstractRaffleActivityPartake - 创建参与活动订单 userId:xiaofuge activityId:100301 userRaffleOrderEntity:{"activityId":100301,"activityName":"测试活动","orderId":"269989825843","orderState":"create","orderTime":1753719668000,"strategyId":100006,"userId":"xiaofuge"}
25-07-29.00:21:36.369 [main            ] INFO  RaffleActivityController - 活动抽奖，创建订单 userId:xiaofuge activityId:100301 orderId:269989825843
25-07-29.00:21:36.377 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:xiaofuge strategyId:100006 ruleModel:rule_blacklist
25-07-29.00:21:36.391 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.00:21:36.416 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.00:21:36.419 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单放行 userId:xiaofuge strategyId:100006 ruleModel:rule_blacklist
25-07-29.00:21:36.419 [main            ] INFO  RuleWeightLogicChain   - 抽奖责任链-权重开始 userId:xiaofuge strategyId:100006 ruleModel:rule_weight
25-07-29.00:21:36.437 [main            ] INFO  RuleWeightLogicChain   - 抽奖责任链-权重接管 userId:xiaofuge strategyId:100006 ruleModel:rule_weight awardId:102
25-07-29.00:21:36.437 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 xiaofuge 100006 102 rule_weight
25-07-29.00:21:36.508 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardId":102,"awardTitle":"OpenAI会员卡","userId":"xiaofuge"},"id":"62951030144","timestamp":1753719696460}
25-07-29.00:21:36.518 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardId":102,"awardTitle":"OpenAI会员卡","userId":"xiaofuge"},"id":"62951030144","timestamp":1753719696460}
25-07-29.00:21:36.523 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"xiaofuge"}
25-07-29.00:21:36.526 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":102,"awardIndex":2,"awardTitle":"OpenAI会员卡"},"info":"成功"}
25-07-29.00:21:36.544 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:21:36.545 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:21:36.547 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.00:21:36.779 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:21:36.793 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:21:37.538 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.00:21:37.544 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:21:37.545 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.00:21:37.545 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:32:36.010 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 8364 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.16:32:36.019 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.16:32:40.070 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.16:32:40.073 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.16:32:40.110 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 22 ms. Found 0 Redis repository interfaces.
25-07-29.16:32:41.449 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.16:32:41.832 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:32:41.845 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:32:44.744 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.16:32:44.800 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.16:32:44.856 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#62faf77:0/SimpleConnection@98712fa [delegate=amqp://admin@127.0.0.1:5672/, localPort= 14137]
25-07-29.16:32:44.937 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 9.296 seconds (JVM running for 10.225)
25-07-29.16:32:45.032 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:32:45.032 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:32:45.184 [main            ] INFO  RaffleActivityController - 活动装配，数据预热，开始 activityId:100301
25-07-29.16:32:45.185 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:32:45.346 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:32:45.346 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:32:45.347 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:32:45.470 [main            ] INFO  RaffleActivityController - 活动装配，数据预热，完成 activityId:100301
25-07-29.16:32:45.489 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":true,"info":"成功"}
25-07-29.16:32:45.506 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:32:45.508 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:32:45.512 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:32:45.930 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:32:45.930 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:32:45.939 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:32:45.941 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:32:45.943 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:32:45.943 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:32:52.936 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 32756 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.16:32:52.942 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.16:32:53.676 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.16:32:53.678 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.16:32:53.708 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 Redis repository interfaces.
25-07-29.16:32:54.731 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.16:32:55.016 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:32:55.029 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:32:57.281 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.16:32:57.334 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.16:32:57.382 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#62faf77:0/SimpleConnection@98712fa [delegate=amqp://admin@127.0.0.1:5672/, localPort= 14258]
25-07-29.16:32:57.460 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.828 seconds (JVM running for 5.376)
25-07-29.16:32:57.628 [main            ] INFO  RaffleActivityController - 日历签到返利开始 userId:user003
25-07-29.16:32:57.643 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:32:57.854 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:32:57.881 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:32:57.905 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:32:58.046 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"user003_sku_20250729","rebateConfig":"9011","rebateType":"sku","userId":"user003"},"id":"47070641967","timestamp":1753777977878}
25-07-29.16:32:58.056 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 topic: send_rebate message: {"data":{"bizId":"user003_sku_20250729","rebateConfig":"9011","rebateType":"sku","userId":"user003"},"id":"47070641967","timestamp":1753777977878}
25-07-29.16:32:58.067 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"user003_integral_20250729","rebateConfig":"10","rebateType":"integral","userId":"user003"},"id":"35858555251","timestamp":1753777977879}
25-07-29.16:32:58.079 [main            ] INFO  RaffleActivityController - 日历签到返利完成 userId:user003 orderIds: ["631103532493","638065281194"]
25-07-29.16:32:58.084 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":true,"info":"成功"}
25-07-29.16:32:58.104 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:32:58.106 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:32:58.107 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:32:58.171 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivityBaseActionChain - 活动责任链-基础信息【有效期、状态、库存(sku)】校验开始。sku:9011 activityId:100301
25-07-29.16:32:58.171 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【校验&扣减】开始。
25-07-29.16:32:58.176 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【有效期、状态、库存（sku）】成功。sku：9011 activityId:100301
25-07-29.16:32:58.236 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:32:58.442 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:32:58.457 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:32:58.460 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:32:58.460 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:32:58.460 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:34:18.972 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 1968 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.16:34:18.973 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.16:34:19.654 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.16:34:19.656 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.16:34:19.682 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 Redis repository interfaces.
25-07-29.16:34:20.686 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.16:34:21.016 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:34:21.030 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:34:23.203 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.16:34:23.267 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.16:34:23.317 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#62faf77:0/SimpleConnection@98712fa [delegate=amqp://admin@127.0.0.1:5672/, localPort= 14390]
25-07-29.16:34:23.412 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 topic: send_rebate message: {"data":{"bizId":"user003_integral_20250729","rebateConfig":"10","rebateType":"integral","userId":"user003"},"id":"35858555251","timestamp":1753777977879}
25-07-29.16:34:23.428 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.765 seconds (JVM running for 5.307)
25-07-29.16:34:23.537 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 - 非sku奖励暂时不处理 topic: send_rebate message: {"data":{"bizId":"user003_integral_20250729","rebateConfig":"10","rebateType":"integral","userId":"user003"},"id":"35858555251","timestamp":1753777977879}
25-07-29.16:34:23.575 [main            ] INFO  RaffleActivityController - 日历签到返利开始 userId:user003
25-07-29.16:34:23.587 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:34:23.759 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:34:23.782 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:34:23.804 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:34:23.850 [main            ] ERROR BehaviorRebateRepository - 写入返利记录，唯一索引冲突 userId: user003
org.springframework.dao.DuplicateKeyException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
### The error may exist in file [D:\DevTool\Java\java_pro\ddd\big-market\big-market-app\target\classes\mybatis\mapper\user_behavior_rebate_order_mapper.xml]
### The error may involve com.lin.infrastructure.persistent.dao.IUserBehaviorRebateOrderDao.insert-Inline
### The error occurred while setting parameters
### SQL: insert into user_behavior_rebate_order_002(         user_id, order_id, behavior_type, rebate_desc, rebate_type, rebate_config, out_business_no,biz_id, create_time, update_time         ) values(         ?, ?, ?, ?, ?, ?,  ?, ?, now(), now()         )
### Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
; Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'; nested exception is java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:247)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy109.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy142.insert(Unknown Source)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:220)
	at com.sun.proxy.$Proxy143.insert(Unknown Source)
	at com.lin.infrastructure.persistent.repository.BehaviorRebateRepository.lambda$saveUserRebateRecord$0(BehaviorRebateRepository.java:84)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
	at com.lin.infrastructure.persistent.repository.BehaviorRebateRepository.saveUserRebateRecord(BehaviorRebateRepository.java:70)
	at com.lin.domain.rebate.service.BehaviorRebateService.createOrder(BehaviorRebateService.java:87)
	at com.lin.trigger.http.RaffleActivityController.calendarSignRebate(RaffleActivityController.java:198)
	at com.lin.test.trigger.RaffleActivityControllerTest.test_calendarSignRebate(RaffleActivityControllerTest.java:67)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy206.update(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 56 common frames omitted
25-07-29.16:34:23.858 [main            ] ERROR RaffleActivityController - 日历签到返利异常 userId:user003 
com.lin.types.exception.AppException: null
	at com.lin.infrastructure.persistent.repository.BehaviorRebateRepository.lambda$saveUserRebateRecord$0(BehaviorRebateRepository.java:100)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
	at com.lin.infrastructure.persistent.repository.BehaviorRebateRepository.saveUserRebateRecord(BehaviorRebateRepository.java:70)
	at com.lin.domain.rebate.service.BehaviorRebateService.createOrder(BehaviorRebateService.java:87)
	at com.lin.trigger.http.RaffleActivityController.calendarSignRebate(RaffleActivityController.java:198)
	at com.lin.test.trigger.RaffleActivityControllerTest.test_calendarSignRebate(RaffleActivityControllerTest.java:67)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)
Caused by: org.springframework.dao.DuplicateKeyException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
### The error may exist in file [D:\DevTool\Java\java_pro\ddd\big-market\big-market-app\target\classes\mybatis\mapper\user_behavior_rebate_order_mapper.xml]
### The error may involve com.lin.infrastructure.persistent.dao.IUserBehaviorRebateOrderDao.insert-Inline
### The error occurred while setting parameters
### SQL: insert into user_behavior_rebate_order_002(         user_id, order_id, behavior_type, rebate_desc, rebate_type, rebate_config, out_business_no,biz_id, create_time, update_time         ) values(         ?, ?, ?, ?, ?, ?,  ?, ?, now(), now()         )
### Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
; Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'; nested exception is java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:247)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy109.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy142.insert(Unknown Source)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:220)
	at com.sun.proxy.$Proxy143.insert(Unknown Source)
	at com.lin.infrastructure.persistent.repository.BehaviorRebateRepository.lambda$saveUserRebateRecord$0(BehaviorRebateRepository.java:84)
	... 38 common frames omitted
Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy206.update(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 56 common frames omitted
25-07-29.16:34:23.875 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0003"}
25-07-29.16:34:23.888 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:34:23.890 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:34:23.891 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:34:24.397 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:34:24.423 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:34:24.548 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:34:24.550 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:34:24.551 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:34:24.551 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:35:54.825 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 20732 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.16:35:54.832 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.16:35:55.563 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.16:35:55.565 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.16:35:55.595 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 0 Redis repository interfaces.
25-07-29.16:35:56.670 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.16:35:56.966 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:35:56.977 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:35:59.187 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.16:35:59.237 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.16:35:59.281 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#62faf77:0/SimpleConnection@57f1a1de [delegate=amqp://admin@127.0.0.1:5672/, localPort= 14517]
25-07-29.16:35:59.366 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.845 seconds (JVM running for 5.384)
25-07-29.16:35:59.510 [main            ] INFO  RaffleActivityController - 活动抽奖 userId:user003 activityId:100301
25-07-29.16:35:59.575 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:35:59.748 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:35:59.813 [main            ] INFO  RaffleActivityController - 活动抽奖，创建订单 userId:user003 activityId:100301 orderId:151136225593
25-07-29.16:35:59.820 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist
25-07-29.16:35:59.834 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:35:59.862 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:35:59.864 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist awardId:101
25-07-29.16:35:59.865 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 user003 100006 101 rule_blacklist
25-07-29.16:36:00.038 [pool-3-thread-3 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:36:00.055 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"61829369591","timestamp":1753778159892}
25-07-29.16:36:00.063 [pool-3-thread-3 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:36:00.067 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"61829369591","timestamp":1753778159892}
25-07-29.16:36:00.069 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"user003"}
25-07-29.16:36:00.072 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":101,"awardIndex":1,"awardTitle":"随机积分"},"info":"成功"}
25-07-29.16:36:00.098 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] WARN  AwardRepository        - 更新中奖记录，重复更新拦截 userId:user003 giveOutPrizesAggregate:{"userAwardRecordEntity":{"awardId":101,"awardState":"complete","userId":"user003"},"userCreditAwardEntity":{"creditAmount":94.3,"userId":"user003"},"userId":"user003"}
25-07-29.16:36:53.561 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:36:53.565 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:36:53.570 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:36:53.660 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:36:53.921 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:36:53.922 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:36:53.925 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:36:53.925 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:36:53.925 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:36:56.127 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 4600 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.16:36:56.133 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.16:36:56.806 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.16:36:56.809 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.16:36:56.835 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 Redis repository interfaces.
25-07-29.16:36:57.902 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.16:36:58.226 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:36:58.237 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:37:00.410 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.16:37:00.460 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.16:37:00.504 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#62faf77:0/SimpleConnection@98712fa [delegate=amqp://admin@127.0.0.1:5672/, localPort= 14646]
25-07-29.16:37:00.581 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.752 seconds (JVM running for 5.315)
25-07-29.16:37:00.733 [main            ] INFO  RaffleActivityController - 活动抽奖 userId:user003 activityId:100301
25-07-29.16:37:00.799 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:37:00.969 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:37:01.027 [main            ] INFO  RaffleActivityController - 活动抽奖，创建订单 userId:user003 activityId:100301 orderId:127450294319
25-07-29.16:37:01.035 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist
25-07-29.16:37:01.048 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:37:01.069 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:37:01.071 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist awardId:101
25-07-29.16:37:01.071 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 user003 100006 101 rule_blacklist
25-07-29.16:37:01.240 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"90011420965","timestamp":1753778221076}
25-07-29.16:37:01.248 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"90011420965","timestamp":1753778221076}
25-07-29.16:37:01.251 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"user003"}
25-07-29.16:37:01.253 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":101,"awardIndex":1,"awardTitle":"随机积分"},"info":"成功"}
25-07-29.16:37:01.289 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] WARN  AwardRepository        - 更新中奖记录，重复更新拦截 userId:user003 giveOutPrizesAggregate:{"userAwardRecordEntity":{"awardId":101,"awardState":"complete","userId":"user003"},"userCreditAwardEntity":{"creditAmount":6.25,"userId":"user003"},"userId":"user003"}
25-07-29.16:37:05.021 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:37:05.060 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:40:20.648 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:40:20.650 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:40:20.650 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:40:21.360 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:40:21.481 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:40:21.608 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:40:21.612 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:40:21.613 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:40:21.613 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:40:23.995 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 25456 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.16:40:23.995 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.16:40:24.687 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.16:40:24.689 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.16:40:24.717 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 Redis repository interfaces.
25-07-29.16:40:25.805 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.16:40:26.104 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:40:26.118 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:40:28.557 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.16:40:28.614 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.16:40:28.668 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#62faf77:0/SimpleConnection@98712fa [delegate=amqp://admin@127.0.0.1:5672/, localPort= 14906]
25-07-29.16:40:28.749 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 5.051 seconds (JVM running for 5.587)
25-07-29.16:40:28.906 [main            ] INFO  RaffleActivityController - 活动抽奖 userId:user003 activityId:100301
25-07-29.16:40:28.976 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:40:29.157 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:40:29.214 [main            ] INFO  RaffleActivityController - 活动抽奖，创建订单 userId:user003 activityId:100301 orderId:780558489902
25-07-29.16:40:29.221 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist
25-07-29.16:40:29.233 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:40:29.255 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:40:29.257 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist awardId:101
25-07-29.16:40:29.258 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 user003 100006 101 rule_blacklist
25-07-29.16:40:29.427 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"19775680720","timestamp":1753778429263}
25-07-29.16:40:29.434 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"19775680720","timestamp":1753778429263}
25-07-29.16:40:29.438 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"user003"}
25-07-29.16:40:29.441 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":101,"awardIndex":1,"awardTitle":"随机积分"},"info":"成功"}
25-07-29.16:40:29.474 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] WARN  AwardRepository        - 更新中奖记录，重复更新拦截 userId:user003 giveOutPrizesAggregate:{"userAwardRecordEntity":{"awardId":101,"awardState":"complete","userId":"user003"},"userCreditAwardEntity":{"creditAmount":96.2,"userId":"user003"},"userId":"user003"}
25-07-29.16:40:30.021 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:40:30.036 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:59:29.546 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:59:29.548 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:59:29.550 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.16:59:29.668 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:59:29.750 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:59:30.418 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.16:59:30.421 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:59:30.421 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:59:30.421 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.16:59:33.955 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 23480 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.16:59:33.962 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.16:59:34.741 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.16:59:34.744 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.16:59:34.775 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 Redis repository interfaces.
25-07-29.16:59:35.866 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.16:59:36.214 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:59:36.229 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.16:59:38.476 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.16:59:38.526 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.16:59:38.572 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#62faf77:0/SimpleConnection@98712fa [delegate=amqp://admin@127.0.0.1:5672/, localPort= 1223]
25-07-29.16:59:38.727 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 5.064 seconds (JVM running for 5.609)
25-07-29.16:59:38.870 [main            ] INFO  RaffleActivityController - 活动抽奖 userId:user003 activityId:100301
25-07-29.16:59:38.943 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:59:39.122 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:59:39.179 [main            ] INFO  RaffleActivityController - 活动抽奖，创建订单 userId:user003 activityId:100301 orderId:081556829815
25-07-29.16:59:39.187 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist
25-07-29.16:59:39.199 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:59:39.234 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.16:59:39.236 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist awardId:101
25-07-29.16:59:39.237 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 user003 100006 101 rule_blacklist
25-07-29.16:59:39.392 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"82857138004","timestamp":1753779579242}
25-07-29.16:59:39.401 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"82857138004","timestamp":1753779579242}
25-07-29.16:59:39.404 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"user003"}
25-07-29.16:59:39.407 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":101,"awardIndex":1,"awardTitle":"随机积分"},"info":"成功"}
25-07-29.16:59:39.458 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] WARN  AwardRepository        - 更新中奖记录，重复更新拦截 userId:user003 giveOutPrizesAggregate:{"userAwardRecordEntity":{"awardId":101,"awardState":"complete","userId":"user003"},"userCreditAwardEntity":{"creditAmount":25.0,"userId":"user003"},"userId":"user003"}
25-07-29.16:59:40.015 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.16:59:40.032 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:00:36.700 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:00:36.701 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:00:36.702 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:00:37.049 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:00:37.280 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:00:37.279 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:00:37.286 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:00:37.286 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:00:37.286 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:02:26.906 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 5840 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.17:02:26.906 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.17:02:27.656 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.17:02:27.658 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.17:02:27.689 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 0 Redis repository interfaces.
25-07-29.17:02:28.893 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.17:02:29.212 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.17:02:29.224 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.17:02:31.652 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.17:02:31.713 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.17:02:31.763 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#76b019c4:0/SimpleConnection@3705a85c [delegate=amqp://admin@127.0.0.1:5672/, localPort= 1467]
25-07-29.17:02:31.834 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 5.269 seconds (JVM running for 6.505)
25-07-29.17:02:32.011 [main            ] INFO  RaffleActivityController - 活动抽奖 userId:user003 activityId:100301
25-07-29.17:02:32.089 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:02:32.291 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:04:09.859 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=2m7s568ms590µs200ns).
25-07-29.17:04:09.879 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:04:11.818 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:04:11.824 [main            ] INFO  RaffleActivityController - 活动抽奖，创建订单 userId:user003 activityId:100301 orderId:601948112015
25-07-29.17:04:17.946 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist
25-07-29.17:04:17.966 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:04:17.992 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:04:17.995 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist awardId:101
25-07-29.17:04:17.996 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 user003 100006 101 rule_blacklist
25-07-29.17:04:18.180 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"85118132321","timestamp":1753779858003}
25-07-29.17:04:18.193 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"85118132321","timestamp":1753779858003}
25-07-29.17:04:18.200 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"user003"}
25-07-29.17:04:18.204 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":101,"awardIndex":1,"awardTitle":"随机积分"},"info":"成功"}
25-07-29.17:04:18.242 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] WARN  AwardRepository        - 更新中奖记录，重复更新拦截 userId:user003 giveOutPrizesAggregate:{"userAwardRecordEntity":{"awardId":101,"awardState":"complete","userId":"user003"},"userCreditAwardEntity":{"creditAmount":99.9,"userId":"user003"},"userId":"user003"}
25-07-29.17:04:40.140 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:04:40.143 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:04:40.143 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:04:40.180 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:04:40.180 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:04:40.409 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:04:40.412 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:04:40.412 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:04:40.412 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:04:42.929 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 33248 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.17:04:42.930 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.17:04:43.661 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.17:04:43.663 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.17:04:43.694 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 0 Redis repository interfaces.
25-07-29.17:04:44.862 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.17:04:45.155 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.17:04:45.164 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.17:04:47.538 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.17:04:47.598 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.17:04:47.650 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#6d41200c:0/SimpleConnection@773cc551 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 1598]
25-07-29.17:04:47.725 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 5.128 seconds (JVM running for 5.829)
25-07-29.17:04:47.905 [main            ] INFO  RaffleActivityController - 活动抽奖 userId:user003 activityId:100301
25-07-29.17:04:47.986 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:04:48.190 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:04:49.946 [main            ] INFO  RaffleActivityController - 活动抽奖，创建订单 userId:user003 activityId:100301 orderId:565980381071
25-07-29.17:05:04.558 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist
25-07-29.17:05:04.598 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:05:04.641 [pool-3-thread-3 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:05:04.672 [pool-3-thread-3 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:05:04.981 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:05:04.989 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist awardId:101
25-07-29.17:05:41.482 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=1m6s499ms614µs800ns).
25-07-29.17:05:41.482 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=52s511ms545µs300ns).
25-07-29.17:05:41.485 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 user003 100006 101 rule_blacklist
25-07-29.17:08:32.992 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=2m51s511ms3µs600ns).
25-07-29.17:08:32.993 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=2m51s511ms4µs800ns).
25-07-29.17:08:32.996 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=2m51s511ms260µs500ns).
25-07-29.17:08:33.028 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:08:33.028 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:08:33.028 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:08:33.028 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:08:33.028 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:08:33.028 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:08:33.030 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:08:33.032 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:08:33.032 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:08:36.957 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 27776 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.17:08:36.958 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.17:08:37.714 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.17:08:37.716 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.17:08:37.744 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 Redis repository interfaces.
25-07-29.17:08:38.777 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.17:08:39.064 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.17:08:39.075 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.17:08:41.535 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.17:08:41.602 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.17:08:41.658 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#62faf77:0/SimpleConnection@98712fa [delegate=amqp://admin@127.0.0.1:5672/, localPort= 1739]
25-07-29.17:08:41.749 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 5.071 seconds (JVM running for 5.598)
25-07-29.17:08:41.921 [main            ] INFO  RaffleActivityController - 活动抽奖 userId:user003 activityId:100301
25-07-29.17:08:41.997 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:08:42.186 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:08:42.250 [main            ] INFO  RaffleActivityController - 活动抽奖，创建订单 userId:user003 activityId:100301 orderId:401623723617
25-07-29.17:08:42.258 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist
25-07-29.17:08:42.271 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:08:42.297 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:08:42.299 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist awardId:101
25-07-29.17:08:42.300 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 user003 100006 101 rule_blacklist
25-07-29.17:08:42.475 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"92871423711","timestamp":1753780122307}
25-07-29.17:08:42.483 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"92871423711","timestamp":1753780122307}
25-07-29.17:08:42.487 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"user003"}
25-07-29.17:08:42.491 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":101,"awardIndex":1,"awardTitle":"随机积分"},"info":"成功"}
25-07-29.17:08:42.528 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] WARN  AwardRepository        - 更新中奖记录，重复更新拦截 userId:user003 giveOutPrizesAggregate:{"userAwardRecordEntity":{"awardId":101,"awardState":"complete","userId":"user003"},"userCreditAwardEntity":{"creditAmount":7.35,"userId":"user003"},"userId":"user003"}
25-07-29.17:08:45.009 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:08:45.017 [pool-3-thread-4 ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"45663964288","timestamp":1753780113005}
25-07-29.17:08:45.022 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardId":101,"awardTitle":"随机积分","userId":"user003"},"id":"45663964288","timestamp":1753780113005}
25-07-29.17:08:45.031 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:08:45.034 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] WARN  AwardRepository        - 更新中奖记录，重复更新拦截 userId:user003 giveOutPrizesAggregate:{"userAwardRecordEntity":{"awardId":101,"awardState":"complete","userId":"user003"},"userCreditAwardEntity":{"creditAmount":12.3,"userId":"user003"},"userId":"user003"}
25-07-29.17:11:57.571 [main            ] INFO  AwardServiceTest       - Starting AwardServiceTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 22184 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.17:11:57.572 [main            ] INFO  AwardServiceTest       - The following 1 profile is active: "dev"
25-07-29.17:11:58.294 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.17:11:58.296 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.17:11:58.323 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 Redis repository interfaces.
25-07-29.17:11:59.348 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.17:11:59.657 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.17:11:59.670 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.17:12:01.791 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.17:12:01.843 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.17:12:01.890 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#62faf77:0/SimpleConnection@98712fa [delegate=amqp://admin@127.0.0.1:5672/, localPort= 1881]
25-07-29.17:12:01.974 [main            ] INFO  AwardServiceTest       - Started AwardServiceTest in 4.677 seconds (JVM running for 5.212)
25-07-29.17:12:02.154 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:12:02.339 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:12:02.366 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:12:02.393 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:12:02.532 [main            ] WARN  AwardRepository        - 更新中奖记录，重复更新拦截 userId:xiaofuge giveOutPrizesAggregate:{"userAwardRecordEntity":{"awardId":101,"awardState":"complete","orderId":"690124733440","userId":"xiaofuge"},"userCreditAwardEntity":{"creditAmount":0.618,"userId":"xiaofuge"},"userId":"xiaofuge"}
25-07-29.17:12:02.554 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:12:02.555 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:12:02.557 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:12:02.963 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:12:02.963 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:12:02.975 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:12:02.978 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:12:02.978 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:12:02.978 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:12:15.458 [main            ] INFO  AwardServiceTest       - Starting AwardServiceTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 23176 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.17:12:15.465 [main            ] INFO  AwardServiceTest       - The following 1 profile is active: "dev"
25-07-29.17:12:16.194 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.17:12:16.196 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.17:12:16.223 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 Redis repository interfaces.
25-07-29.17:12:17.283 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.17:12:17.593 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.17:12:17.608 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.17:12:19.744 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.17:12:19.800 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.17:12:19.860 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#1f39269d:0/SimpleConnection@61288814 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 2195]
25-07-29.17:12:19.947 [main            ] INFO  AwardServiceTest       - Started AwardServiceTest in 4.767 seconds (JVM running for 5.316)
25-07-29.17:12:20.037 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:12:20.037 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:12:20.119 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.17:12:20.268 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:12:20.268 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:12:20.269 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.17:12:20.330 [main            ] WARN  AwardRepository        - 更新中奖记录，重复更新拦截 userId:xiaofuge giveOutPrizesAggregate:{"userAwardRecordEntity":{"awardId":101,"awardState":"complete","orderId":"690124733441","userId":"xiaofuge"},"userCreditAwardEntity":{"creditAmount":0.0345,"userId":"xiaofuge"},"userId":"xiaofuge"}
25-07-29.17:12:20.352 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:12:20.354 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:12:20.355 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.17:12:20.929 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:12:20.929 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:12:20.943 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.17:12:20.945 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:12:20.946 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:12:20.946 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.17:14:10.352 [main            ] INFO  AwardServiceTest       - Starting AwardServiceTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 20660 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.17:14:10.353 [main            ] INFO  AwardServiceTest       - The following 1 profile is active: "dev"
25-07-29.17:14:11.141 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.17:14:11.144 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.17:14:11.179 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 23 ms. Found 0 Redis repository interfaces.
25-07-29.17:14:12.344 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.17:14:12.639 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.17:14:12.656 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.17:14:15.265 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.17:14:15.329 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.17:14:15.390 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#63c6c5e5:0/SimpleConnection@7364073b [delegate=amqp://admin@127.0.0.1:5672/, localPort= 2429]
25-07-29.17:14:15.463 [main            ] INFO  AwardServiceTest       - Started AwardServiceTest in 5.437 seconds (JVM running for 6.06)
25-07-29.19:00:37.592 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:00:37.595 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:00:37.597 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:00:37.656 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:00:37.656 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:00:37.656 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:00:37.656 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:00:37.656 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:00:37.656 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:00:37.663 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:00:37.664 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:00:37.664 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:00:37.672 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.19:00:37.672 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.19:00:37.672 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.19:00:37.678 [scheduling-1    ] ERROR UpdateActivitySkuStockJob - 定时任务，更新活动sku库存失败
org.springframework.beans.factory.BeanCreationNotAllowedException: Error creating bean with name 'redissonConnectionFactory': Singleton bean creation not allowed while singletons of this factory are in destruction (Do not request a bean from a BeanFactory in a destroy method implementation!)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:220)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory$1.orderedStream(DefaultListableBeanFactory.java:481)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.detectPersistenceExceptionTranslators(PersistenceExceptionTranslationInterceptor.java:167)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:149)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at com.lin.infrastructure.persistent.repository.ActivityRepository$$EnhancerBySpringCGLIB$$e0028325.querySkuList(<generated>)
	at com.lin.domain.activity.service.quota.RaffleActivityAccountQuotaService.querySkuList(RaffleActivityAccountQuotaService.java:78)
	at com.lin.trigger.job.UpdateActivitySkuStockJob.exec(UpdateActivitySkuStockJob.java:32)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:266)
	at java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
25-07-29.19:00:38.256 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:00:38.364 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:00:38.364 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:00:38.369 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:00:38.369 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:00:38.369 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:53:23.333 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 33060 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.19:53:23.339 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.19:53:24.106 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.19:53:24.107 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.19:53:24.144 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 27 ms. Found 0 Redis repository interfaces.
25-07-29.19:53:25.198 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.19:53:25.514 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.19:53:25.528 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.19:53:27.707 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.19:53:27.756 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.19:53:27.805 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#62faf77:0/SimpleConnection@57f1a1de [delegate=amqp://admin@127.0.0.1:5672/, localPort= 4227]
25-07-29.19:53:27.890 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.846 seconds (JVM running for 5.395)
25-07-29.19:53:28.029 [main            ] INFO  RaffleActivityController - 查询用户是否完成日历签到返利开始 userId:user002
25-07-29.19:53:28.047 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.19:53:28.222 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.19:53:28.253 [main            ] INFO  RaffleActivityController - 查询用户是否完成日历签到返利完成 userId:user002 orders.size:0
25-07-29.19:53:28.347 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":false,"info":"成功"}
25-07-29.19:53:28.361 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:53:28.362 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:53:28.364 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:53:28.885 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:53:28.885 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:53:28.897 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:53:28.899 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:53:28.899 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:53:28.899 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:53:54.510 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 20560 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.19:53:54.511 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.19:53:55.213 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.19:53:55.216 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.19:53:55.246 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 0 Redis repository interfaces.
25-07-29.19:53:56.366 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.19:53:56.696 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.19:53:56.710 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.19:53:58.802 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.19:53:58.855 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.19:53:58.909 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#62faf77:0/SimpleConnection@98712fa [delegate=amqp://admin@127.0.0.1:5672/, localPort= 4320]
25-07-29.19:53:59.015 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.818 seconds (JVM running for 5.377)
25-07-29.19:53:59.182 [main            ] INFO  RaffleActivityController - 查询用户是否完成日历签到返利开始 userId:user003
25-07-29.19:53:59.204 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.19:53:59.388 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.19:53:59.412 [main            ] INFO  RaffleActivityController - 查询用户是否完成日历签到返利完成 userId:user003 orders.size:2
25-07-29.19:53:59.514 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":true,"info":"成功"}
25-07-29.19:53:59.527 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:53:59.528 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:53:59.530 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:53:59.982 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:54:00.001 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:54:00.006 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:54:00.012 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:54:00.012 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:54:00.012 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:54:00.033 [scheduling-1    ] ERROR UpdateActivitySkuStockJob - 定时任务，更新活动sku库存失败
org.springframework.beans.factory.BeanCreationNotAllowedException: Error creating bean with name 'redissonConnectionFactory': Singleton bean creation not allowed while singletons of this factory are in destruction (Do not request a bean from a BeanFactory in a destroy method implementation!)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:220)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory$1.orderedStream(DefaultListableBeanFactory.java:481)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.detectPersistenceExceptionTranslators(PersistenceExceptionTranslationInterceptor.java:167)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:149)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at com.lin.infrastructure.persistent.repository.ActivityRepository$$EnhancerBySpringCGLIB$$a517b34e.querySkuList(<generated>)
	at com.lin.domain.activity.service.quota.RaffleActivityAccountQuotaService.querySkuList(RaffleActivityAccountQuotaService.java:78)
	at com.lin.trigger.job.UpdateActivitySkuStockJob.exec(UpdateActivitySkuStockJob.java:32)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at org.springframework.scheduling.concurrent.ReschedulingRunnable.run(ReschedulingRunnable.java:95)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
25-07-29.19:54:13.857 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 16228 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.19:54:13.858 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.19:54:14.506 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.19:54:14.508 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.19:54:14.535 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 Redis repository interfaces.
25-07-29.19:54:15.466 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.19:54:15.837 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.19:54:15.852 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.19:54:18.006 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.19:54:18.058 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.19:54:18.106 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#1f39269d:0/SimpleConnection@4a6ef712 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 4415]
25-07-29.19:54:18.202 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.63 seconds (JVM running for 5.161)
25-07-29.19:54:18.385 [main            ] INFO  RaffleActivityController - 日历签到返利开始 userId:user003
25-07-29.19:54:18.400 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.19:54:18.602 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.19:54:18.634 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.19:54:18.659 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.19:54:18.707 [main            ] ERROR BehaviorRebateRepository - 写入返利记录，唯一索引冲突 userId: user003
org.springframework.dao.DuplicateKeyException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
### The error may exist in file [D:\DevTool\Java\java_pro\ddd\big-market\big-market-app\target\classes\mybatis\mapper\user_behavior_rebate_order_mapper.xml]
### The error may involve com.lin.infrastructure.persistent.dao.IUserBehaviorRebateOrderDao.insert-Inline
### The error occurred while setting parameters
### SQL: insert into user_behavior_rebate_order_002(         user_id, order_id, behavior_type, rebate_desc, rebate_type, rebate_config, out_business_no,biz_id, create_time, update_time         ) values(         ?, ?, ?, ?, ?, ?,  ?, ?, now(), now()         )
### Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
; Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'; nested exception is java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:247)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy109.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy142.insert(Unknown Source)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:220)
	at com.sun.proxy.$Proxy143.insert(Unknown Source)
	at com.lin.infrastructure.persistent.repository.BehaviorRebateRepository.lambda$saveUserRebateRecord$0(BehaviorRebateRepository.java:84)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
	at com.lin.infrastructure.persistent.repository.BehaviorRebateRepository.saveUserRebateRecord(BehaviorRebateRepository.java:70)
	at com.lin.domain.rebate.service.BehaviorRebateService.createOrder(BehaviorRebateService.java:87)
	at com.lin.trigger.http.RaffleActivityController.calendarSignRebate(RaffleActivityController.java:199)
	at com.lin.test.trigger.RaffleActivityControllerTest.test_calendarSignRebate(RaffleActivityControllerTest.java:67)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy206.update(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 56 common frames omitted
25-07-29.19:54:18.715 [main            ] ERROR RaffleActivityController - 日历签到返利异常 userId:user003 
com.lin.types.exception.AppException: null
	at com.lin.infrastructure.persistent.repository.BehaviorRebateRepository.lambda$saveUserRebateRecord$0(BehaviorRebateRepository.java:100)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
	at com.lin.infrastructure.persistent.repository.BehaviorRebateRepository.saveUserRebateRecord(BehaviorRebateRepository.java:70)
	at com.lin.domain.rebate.service.BehaviorRebateService.createOrder(BehaviorRebateService.java:87)
	at com.lin.trigger.http.RaffleActivityController.calendarSignRebate(RaffleActivityController.java:199)
	at com.lin.test.trigger.RaffleActivityControllerTest.test_calendarSignRebate(RaffleActivityControllerTest.java:67)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)
Caused by: org.springframework.dao.DuplicateKeyException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
### The error may exist in file [D:\DevTool\Java\java_pro\ddd\big-market\big-market-app\target\classes\mybatis\mapper\user_behavior_rebate_order_mapper.xml]
### The error may involve com.lin.infrastructure.persistent.dao.IUserBehaviorRebateOrderDao.insert-Inline
### The error occurred while setting parameters
### SQL: insert into user_behavior_rebate_order_002(         user_id, order_id, behavior_type, rebate_desc, rebate_type, rebate_config, out_business_no,biz_id, create_time, update_time         ) values(         ?, ?, ?, ?, ?, ?,  ?, ?, now(), now()         )
### Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
; Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'; nested exception is java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:247)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy109.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy142.insert(Unknown Source)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:220)
	at com.sun.proxy.$Proxy143.insert(Unknown Source)
	at com.lin.infrastructure.persistent.repository.BehaviorRebateRepository.lambda$saveUserRebateRecord$0(BehaviorRebateRepository.java:84)
	... 38 common frames omitted
Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'user003_sku_20250729' for key 'user_behavior_rebate_order_002.uq_biz_id'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy206.update(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 56 common frames omitted
25-07-29.19:54:18.865 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0003"}
25-07-29.19:54:18.881 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:54:18.882 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:54:18.884 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.19:54:19.171 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:54:19.171 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:54:19.185 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.19:54:19.187 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:54:19.187 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:54:19.187 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.19:55:13.156 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 32680 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.19:55:13.163 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.19:55:13.832 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.19:55:13.834 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.19:55:13.862 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 Redis repository interfaces.
25-07-29.19:55:14.841 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.19:55:15.133 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.19:55:15.145 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.19:55:17.251 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.19:55:17.302 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.19:55:17.347 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#62faf77:0/SimpleConnection@98712fa [delegate=amqp://admin@127.0.0.1:5672/, localPort= 4530]
25-07-29.19:55:17.419 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.531 seconds (JVM running for 5.072)
25-07-29.19:55:17.584 [main            ] INFO  RaffleActivityController - 活动抽奖 userId:user003 activityId:100301
25-07-29.19:55:17.654 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.19:55:17.844 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.19:55:17.910 [main            ] INFO  RaffleActivityController - 活动抽奖，创建订单 userId:user003 activityId:100301 orderId:253925168778
25-07-29.19:55:17.919 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist
25-07-29.19:55:17.932 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.19:55:17.955 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.19:55:17.958 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist awardId:101
25-07-29.19:55:17.960 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 user003 100006 101 rule_blacklist
25-07-29.19:55:18.128 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardConfig":"0.01,1","awardId":101,"awardTitle":"随机积分","orderId":"253925168778","userId":"user003"},"id":"62494018546","timestamp":1753790117966}
25-07-29.19:55:18.139 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardConfig":"0.01,1","awardId":101,"awardTitle":"随机积分","orderId":"253925168778","userId":"user003"},"id":"62494018546","timestamp":1753790117966}
25-07-29.19:55:18.140 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"user003"}
25-07-29.19:55:18.143 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":101,"awardIndex":1,"awardTitle":"随机积分"},"info":"成功"}
25-07-29.19:55:20.025 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.19:55:20.057 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.20:00:17.557 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.20:00:17.560 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.20:00:17.561 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.20:00:18.320 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.20:00:18.486 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.20:00:18.529 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.20:00:18.536 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.20:00:18.537 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.20:00:18.537 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.21:40:24.390 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 10968 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.21:40:24.397 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-07-29.21:40:25.096 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.21:40:25.098 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.21:40:25.125 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 Redis repository interfaces.
25-07-29.21:40:26.281 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.21:40:26.598 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.21:40:26.609 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.21:40:28.824 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.21:40:28.875 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.21:40:28.929 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#58186f9f:0/SimpleConnection@4a6ef712 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 10478]
25-07-29.21:40:29.010 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 4.94 seconds (JVM running for 5.533)
25-07-29.21:40:29.164 [main            ] INFO  RaffleActivityController - 活动抽奖 userId:user003 activityId:100301
25-07-29.21:40:29.233 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.21:40:29.421 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.21:40:29.484 [main            ] INFO  RaffleActivityController - 活动抽奖，创建订单 userId:user003 activityId:100301 orderId:159309135247
25-07-29.21:40:29.491 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist
25-07-29.21:40:29.503 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.21:40:29.528 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.21:40:29.530 [main            ] INFO  BackListLogicChain     - 抽奖责任链-黑名单接管 userId:user003 strategyId:100006 ruleModel:rule_blacklist awardId:101
25-07-29.21:40:29.531 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 user003 100006 101 rule_blacklist
25-07-29.21:40:29.709 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardConfig":"0.01,1","awardId":101,"awardTitle":"随机积分","orderId":"159309135247","userId":"user003"},"id":"27163150549","timestamp":1753796429539}
25-07-29.21:40:29.719 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardConfig":"0.01,1","awardId":101,"awardTitle":"随机积分","orderId":"159309135247","userId":"user003"},"id":"27163150549","timestamp":1753796429539}
25-07-29.21:40:29.723 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"user003"}
25-07-29.21:40:29.724 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":101,"awardIndex":1,"awardTitle":"随机积分"},"info":"成功"}
25-07-29.21:40:30.020 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.21:40:30.037 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.21:42:26.974 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.21:42:26.976 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.21:42:26.977 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.21:42:27.155 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.21:42:27.157 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.21:42:27.947 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.21:42:27.951 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.21:42:27.952 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.21:42:27.952 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:26:20.568 [main            ] INFO  CreditAdjustServiceTest - Starting CreditAdjustServiceTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 27288 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.22:26:20.569 [main            ] INFO  CreditAdjustServiceTest - The following 1 profile is active: "dev"
25-07-29.22:26:21.518 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.22:26:21.520 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.22:26:21.548 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 Redis repository interfaces.
25-07-29.22:26:22.623 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.22:26:23.048 [redisson-netty-2-5] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.22:26:23.060 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.22:26:25.484 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.22:26:25.537 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.22:26:25.594 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#149d7cc6:0/SimpleConnection@696298ea [delegate=amqp://admin@127.0.0.1:5672/, localPort= 11169]
25-07-29.22:26:25.688 [main            ] INFO  CreditAdjustServiceTest - Started CreditAdjustServiceTest in 5.429 seconds (JVM running for 6.048)
25-07-29.22:26:25.849 [main            ] INFO  CreditAdjustService    - 增加账户积分额度开始 userId:xiaofuge tradeName:REBATE amount:10.19
25-07-29.22:26:25.874 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:26:26.057 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:26:26.114 [main            ] INFO  CreditAdjustService    - 增加账户积分额度完成 userId:xiaofuge orderId:272181126712
25-07-29.22:26:26.125 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:26:26.126 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:26:26.127 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:26:26.669 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:26:26.669 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:26:26.679 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:26:26.683 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:26:26.683 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:26:26.683 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:26:58.916 [main            ] INFO  CreditAdjustServiceTest - Starting CreditAdjustServiceTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 20772 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.22:26:58.916 [main            ] INFO  CreditAdjustServiceTest - The following 1 profile is active: "dev"
25-07-29.22:26:59.609 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.22:26:59.611 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.22:26:59.638 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 Redis repository interfaces.
25-07-29.22:27:00.626 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.22:27:00.926 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.22:27:00.936 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.22:27:03.186 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.22:27:03.242 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.22:27:03.290 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#149d7cc6:0/SimpleConnection@696298ea [delegate=amqp://admin@127.0.0.1:5672/, localPort= 11261]
25-07-29.22:27:03.365 [main            ] INFO  CreditAdjustServiceTest - Started CreditAdjustServiceTest in 4.747 seconds (JVM running for 5.308)
25-07-29.22:27:03.512 [main            ] INFO  CreditAdjustService    - 增加账户积分额度开始 userId:xiaofuge tradeName:REBATE amount:-10.19
25-07-29.22:27:03.536 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:27:03.720 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:27:03.780 [main            ] INFO  CreditAdjustService    - 增加账户积分额度完成 userId:xiaofuge orderId:126876660534
25-07-29.22:27:03.791 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:27:03.792 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:27:03.794 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:27:04.360 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:27:04.360 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:27:04.361 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:27:04.363 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:27:04.364 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:27:04.364 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:34:44.139 [main            ] INFO  BehaviorRebateServiceTest - Starting BehaviorRebateServiceTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 21744 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.22:34:44.140 [main            ] INFO  BehaviorRebateServiceTest - The following 1 profile is active: "dev"
25-07-29.22:34:44.864 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.22:34:44.866 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.22:34:44.895 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 0 Redis repository interfaces.
25-07-29.22:34:45.908 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.22:34:46.373 [redisson-netty-2-5] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.22:34:46.386 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.22:34:48.699 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.22:34:48.781 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.22:34:48.854 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#2712e8f4:0/SimpleConnection@4acc27fd [delegate=amqp://admin@127.0.0.1:5672/, localPort= 11524]
25-07-29.22:34:48.964 [main            ] INFO  BehaviorRebateServiceTest - Started BehaviorRebateServiceTest in 5.09 seconds (JVM running for 5.641)
25-07-29.22:34:49.196 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:34:49.400 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:34:49.498 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:34:49.530 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:34:49.763 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_sku_2024042906","rebateConfig":"9011","rebateType":"sku","userId":"xiaofuge"},"id":"66867772486","timestamp":1753799689495}
25-07-29.22:34:49.773 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 topic: send_rebate message: {"data":{"bizId":"xiaofuge_sku_2024042906","rebateConfig":"9011","rebateType":"sku","userId":"xiaofuge"},"id":"66867772486","timestamp":1753799689495}
25-07-29.22:34:49.780 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_integral_2024042906","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge"},"id":"72559238879","timestamp":1753799689496}
25-07-29.22:34:49.807 [main            ] INFO  BehaviorRebateServiceTest - 请求参数：{"behaviorTypeVO":"SIGN","outBusinessNo":"2024042906","userId":"xiaofuge"}
25-07-29.22:34:49.810 [main            ] INFO  BehaviorRebateServiceTest - 测试结果：["105432850947","542038970583"]
25-07-29.22:34:49.827 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivityBaseActionChain - 活动责任链-基础信息【有效期、状态、库存(sku)】校验开始。sku:9011 activityId:100301
25-07-29.22:34:49.827 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【校验&扣减】开始。
25-07-29.22:34:49.832 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【有效期、状态、库存（sku）】成功。sku：9011 activityId:100301
25-07-29.22:34:49.927 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] ERROR ActivityRepository     - 写入订单记录，唯一索引冲突 userId: xiaofuge activityId: 100301 sku: 9011
org.springframework.dao.DuplicateKeyException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_2024042906' for key 'raffle_activity_order_001.uq_out_business_no'
### The error may exist in file [D:\DevTool\Java\java_pro\ddd\big-market\big-market-app\target\classes\mybatis\mapper\raffle_activity_order_mapper.xml]
### The error may involve com.lin.infrastructure.persistent.dao.IRaffleActivityOrderDao.insert-Inline
### The error occurred while setting parameters
### SQL: insert into raffle_activity_order_001(user_id, sku, activity_id, activity_name, strategy_id, order_id, order_time, state,out_business_no, total_count, day_count, month_count, create_time, update_time)         values(?,?, ?, ?, ?, ?, ?, ?,?,?,?,?, now(), now())
### Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_2024042906' for key 'raffle_activity_order_001.uq_out_business_no'
; Duplicate entry 'xiaofuge_sku_2024042906' for key 'raffle_activity_order_001.uq_out_business_no'; nested exception is java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_2024042906' for key 'raffle_activity_order_001.uq_out_business_no'
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:247)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy110.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy115.insert(Unknown Source)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:220)
	at com.sun.proxy.$Proxy116.insert(Unknown Source)
	at com.lin.infrastructure.persistent.repository.ActivityRepository.lambda$doSaveOrder$0(ActivityRepository.java:192)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
	at com.lin.infrastructure.persistent.repository.ActivityRepository.doSaveOrder(ActivityRepository.java:189)
	at com.lin.infrastructure.persistent.repository.ActivityRepository$$FastClassBySpringCGLIB$$5e252487.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at com.lin.infrastructure.persistent.repository.ActivityRepository$$EnhancerBySpringCGLIB$$6288448c.doSaveOrder(<generated>)
	at com.lin.domain.activity.service.quota.RaffleActivityAccountQuotaService.doSaveOrder(RaffleActivityAccountQuotaService.java:28)
	at com.lin.domain.activity.service.quota.AbstractRaffleActivityAccountQuota.createSkuRechargeOrder(AbstractRaffleActivityAccountQuota.java:65)
	at com.lin.domain.activity.service.quota.AbstractRaffleActivityAccountQuota.createOrder(AbstractRaffleActivityAccountQuota.java:73)
	at com.lin.trigger.listener.RebateMessageCustomer.listener(RebateMessageCustomer.java:60)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:169)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:119)
	at org.springframework.amqp.rabbit.listener.adapter.HandlerAdapter.invoke(HandlerAdapter.java:77)
	at org.springframework.amqp.rabbit.listener.adapter.MessagingMessageListenerAdapter.invokeHandler(MessagingMessageListenerAdapter.java:263)
	at org.springframework.amqp.rabbit.listener.adapter.MessagingMessageListenerAdapter.invokeHandlerAndProcessResult(MessagingMessageListenerAdapter.java:209)
	at org.springframework.amqp.rabbit.listener.adapter.MessagingMessageListenerAdapter.onMessage(MessagingMessageListenerAdapter.java:148)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:1674)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.actualInvokeListener(AbstractMessageListenerContainer.java:1593)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:1581)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:1572)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(AbstractMessageListenerContainer.java:1516)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(SimpleMessageListenerContainer.java:1001)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(SimpleMessageListenerContainer.java:948)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$1600(SimpleMessageListenerContainer.java:86)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.mainLoop(SimpleMessageListenerContainer.java:1326)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(SimpleMessageListenerContainer.java:1232)
	at java.lang.Thread.run(Thread.java:750)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_2024042906' for key 'raffle_activity_order_001.uq_out_business_no'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy208.update(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 55 common frames omitted
25-07-29.22:34:49.940 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] WARN  RebateMessageCustomer  - 监听用户行为返利消息，消费重复 topic: send_rebate message: {"data":{"bizId":"xiaofuge_sku_2024042906","rebateConfig":"9011","rebateType":"sku","userId":"xiaofuge"},"id":"66867772486","timestamp":1753799689495}
com.lin.types.exception.AppException: null
	at com.lin.infrastructure.persistent.repository.ActivityRepository.lambda$doSaveOrder$0(ActivityRepository.java:208)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
	at com.lin.infrastructure.persistent.repository.ActivityRepository.doSaveOrder(ActivityRepository.java:189)
	at com.lin.infrastructure.persistent.repository.ActivityRepository$$FastClassBySpringCGLIB$$5e252487.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at com.lin.infrastructure.persistent.repository.ActivityRepository$$EnhancerBySpringCGLIB$$6288448c.doSaveOrder(<generated>)
	at com.lin.domain.activity.service.quota.RaffleActivityAccountQuotaService.doSaveOrder(RaffleActivityAccountQuotaService.java:28)
	at com.lin.domain.activity.service.quota.AbstractRaffleActivityAccountQuota.createSkuRechargeOrder(AbstractRaffleActivityAccountQuota.java:65)
	at com.lin.domain.activity.service.quota.AbstractRaffleActivityAccountQuota.createOrder(AbstractRaffleActivityAccountQuota.java:73)
	at com.lin.trigger.listener.RebateMessageCustomer.listener(RebateMessageCustomer.java:60)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:169)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:119)
	at org.springframework.amqp.rabbit.listener.adapter.HandlerAdapter.invoke(HandlerAdapter.java:77)
	at org.springframework.amqp.rabbit.listener.adapter.MessagingMessageListenerAdapter.invokeHandler(MessagingMessageListenerAdapter.java:263)
	at org.springframework.amqp.rabbit.listener.adapter.MessagingMessageListenerAdapter.invokeHandlerAndProcessResult(MessagingMessageListenerAdapter.java:209)
	at org.springframework.amqp.rabbit.listener.adapter.MessagingMessageListenerAdapter.onMessage(MessagingMessageListenerAdapter.java:148)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:1674)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.actualInvokeListener(AbstractMessageListenerContainer.java:1593)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:1581)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:1572)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(AbstractMessageListenerContainer.java:1516)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(SimpleMessageListenerContainer.java:1001)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(SimpleMessageListenerContainer.java:948)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$1600(SimpleMessageListenerContainer.java:86)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.mainLoop(SimpleMessageListenerContainer.java:1326)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(SimpleMessageListenerContainer.java:1232)
	at java.lang.Thread.run(Thread.java:750)
Caused by: org.springframework.dao.DuplicateKeyException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_2024042906' for key 'raffle_activity_order_001.uq_out_business_no'
### The error may exist in file [D:\DevTool\Java\java_pro\ddd\big-market\big-market-app\target\classes\mybatis\mapper\raffle_activity_order_mapper.xml]
### The error may involve com.lin.infrastructure.persistent.dao.IRaffleActivityOrderDao.insert-Inline
### The error occurred while setting parameters
### SQL: insert into raffle_activity_order_001(user_id, sku, activity_id, activity_name, strategy_id, order_id, order_time, state,out_business_no, total_count, day_count, month_count, create_time, update_time)         values(?,?, ?, ?, ?, ?, ?, ?,?,?,?,?, now(), now())
### Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_2024042906' for key 'raffle_activity_order_001.uq_out_business_no'
; Duplicate entry 'xiaofuge_sku_2024042906' for key 'raffle_activity_order_001.uq_out_business_no'; nested exception is java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_2024042906' for key 'raffle_activity_order_001.uq_out_business_no'
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:247)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy110.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy115.insert(Unknown Source)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:220)
	at com.sun.proxy.$Proxy116.insert(Unknown Source)
	at com.lin.infrastructure.persistent.repository.ActivityRepository.lambda$doSaveOrder$0(ActivityRepository.java:192)
	... 37 common frames omitted
Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_2024042906' for key 'raffle_activity_order_001.uq_out_business_no'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy208.update(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 55 common frames omitted
25-07-29.22:34:49.943 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 topic: send_rebate message: {"data":{"bizId":"xiaofuge_integral_2024042906","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge"},"id":"72559238879","timestamp":1753799689496}
25-07-29.22:34:49.943 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 - 非sku奖励暂时不处理 topic: send_rebate message: {"data":{"bizId":"xiaofuge_integral_2024042906","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge"},"id":"72559238879","timestamp":1753799689496}
25-07-29.22:34:50.014 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:34:50.032 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:35:09.940 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:35:09.941 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:35:09.942 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:35:10.128 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:35:10.157 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:35:10.157 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:35:10.160 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:35:10.161 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:35:10.161 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:35:13.472 [main            ] INFO  BehaviorRebateServiceTest - Starting BehaviorRebateServiceTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 13564 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.22:35:13.479 [main            ] INFO  BehaviorRebateServiceTest - The following 1 profile is active: "dev"
25-07-29.22:35:14.203 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.22:35:14.205 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.22:35:14.234 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 Redis repository interfaces.
25-07-29.22:35:15.238 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.22:35:15.543 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.22:35:15.574 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.22:35:17.896 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.22:35:17.952 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.22:35:17.999 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#2712e8f4:0/SimpleConnection@24955144 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 11650]
25-07-29.22:35:18.075 [main            ] INFO  BehaviorRebateServiceTest - Started BehaviorRebateServiceTest in 4.885 seconds (JVM running for 5.444)
25-07-29.22:35:18.253 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:35:18.442 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:35:18.518 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:35:18.545 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:35:18.705 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_sku_2024042909","rebateConfig":"9011","rebateType":"sku","userId":"xiaofuge"},"id":"30219116484","timestamp":1753799718516}
25-07-29.22:35:18.714 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 topic: send_rebate message: {"data":{"bizId":"xiaofuge_sku_2024042909","rebateConfig":"9011","rebateType":"sku","userId":"xiaofuge"},"id":"30219116484","timestamp":1753799718516}
25-07-29.22:35:18.721 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_integral_2024042909","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge"},"id":"44546490338","timestamp":1753799718517}
25-07-29.22:35:18.731 [main            ] INFO  BehaviorRebateServiceTest - 请求参数：{"behaviorTypeVO":"SIGN","outBusinessNo":"2024042909","userId":"xiaofuge"}
25-07-29.22:35:18.734 [main            ] INFO  BehaviorRebateServiceTest - 测试结果：["303248730757","044818636710"]
25-07-29.22:35:18.753 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivityBaseActionChain - 活动责任链-基础信息【有效期、状态、库存(sku)】校验开始。sku:9011 activityId:100301
25-07-29.22:35:18.754 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【校验&扣减】开始。
25-07-29.22:35:18.758 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【有效期、状态、库存（sku）】成功。sku：9011 activityId:100301
25-07-29.22:35:18.832 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 topic: send_rebate message: {"data":{"bizId":"xiaofuge_integral_2024042909","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge"},"id":"44546490338","timestamp":1753799718517}
25-07-29.22:35:18.832 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 - 非sku奖励暂时不处理 topic: send_rebate message: {"data":{"bizId":"xiaofuge_integral_2024042909","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge"},"id":"44546490338","timestamp":1753799718517}
25-07-29.22:35:20.024 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:35:20.058 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:36:00.623 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:36:00.625 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:36:00.627 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:36:01.293 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:36:01.495 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:36:01.528 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:36:01.533 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:36:01.533 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:36:01.533 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:36:04.776 [main            ] INFO  BehaviorRebateServiceTest - Starting BehaviorRebateServiceTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 22776 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.22:36:04.783 [main            ] INFO  BehaviorRebateServiceTest - The following 1 profile is active: "dev"
25-07-29.22:36:05.531 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.22:36:05.533 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.22:36:05.563 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 Redis repository interfaces.
25-07-29.22:36:06.536 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.22:36:06.841 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.22:36:06.853 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.22:36:09.179 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.22:36:09.236 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.22:36:09.297 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#2712e8f4:0/SimpleConnection@4acc27fd [delegate=amqp://admin@127.0.0.1:5672/, localPort= 11777]
25-07-29.22:36:09.376 [main            ] INFO  BehaviorRebateServiceTest - Started BehaviorRebateServiceTest in 4.896 seconds (JVM running for 5.416)
25-07-29.22:36:09.565 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:36:09.771 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:36:09.875 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:36:09.902 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:36:09.952 [main            ] ERROR BehaviorRebateRepository - 写入返利记录，唯一索引冲突 userId: xiaofuge
org.springframework.dao.DuplicateKeyException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_2024042909' for key 'user_behavior_rebate_order_001.uq_biz_id'
### The error may exist in file [D:\DevTool\Java\java_pro\ddd\big-market\big-market-app\target\classes\mybatis\mapper\user_behavior_rebate_order_mapper.xml]
### The error may involve com.lin.infrastructure.persistent.dao.IUserBehaviorRebateOrderDao.insert-Inline
### The error occurred while setting parameters
### SQL: insert into user_behavior_rebate_order_001(         user_id, order_id, behavior_type, rebate_desc, rebate_type, rebate_config, out_business_no,biz_id, create_time, update_time         ) values(         ?, ?, ?, ?, ?, ?,  ?, ?, now(), now()         )
### Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_2024042909' for key 'user_behavior_rebate_order_001.uq_biz_id'
; Duplicate entry 'xiaofuge_sku_2024042909' for key 'user_behavior_rebate_order_001.uq_biz_id'; nested exception is java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_2024042909' for key 'user_behavior_rebate_order_001.uq_biz_id'
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:247)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy110.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy143.insert(Unknown Source)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:220)
	at com.sun.proxy.$Proxy144.insert(Unknown Source)
	at com.lin.infrastructure.persistent.repository.BehaviorRebateRepository.lambda$saveUserRebateRecord$0(BehaviorRebateRepository.java:84)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
	at com.lin.infrastructure.persistent.repository.BehaviorRebateRepository.saveUserRebateRecord(BehaviorRebateRepository.java:70)
	at com.lin.domain.rebate.service.BehaviorRebateService.createOrder(BehaviorRebateService.java:87)
	at com.lin.test.domain.rebate.BehaviorRebateServiceTest.test_createOrder(BehaviorRebateServiceTest.java:48)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_2024042909' for key 'user_behavior_rebate_order_001.uq_biz_id'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy208.update(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 56 common frames omitted
25-07-29.22:36:09.979 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:36:09.981 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:36:09.982 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.22:36:10.023 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:36:10.051 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:36:10.357 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:36:10.357 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:36:10.370 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.22:36:10.373 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:36:10.373 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:36:10.373 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.22:36:30.216 [main            ] INFO  BehaviorRebateServiceTest - Starting BehaviorRebateServiceTest using Java 1.8.0_341 on DESKTOP-IQMPG8V with PID 4152 (started by lin in D:\DevTool\Java\java_pro\ddd\big-market\big-market-app)
25-07-29.22:36:30.216 [main            ] INFO  BehaviorRebateServiceTest - The following 1 profile is active: "dev"
25-07-29.22:36:30.922 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-07-29.22:36:30.924 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-07-29.22:36:30.954 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 0 Redis repository interfaces.
25-07-29.22:36:31.961 [main            ] INFO  Version                - Redisson 3.23.4
25-07-29.22:36:32.303 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.22:36:32.319 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:16379
25-07-29.22:36:34.645 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-07-29.22:36:34.695 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-07-29.22:36:34.743 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#2712e8f4:0/SimpleConnection@24955144 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 11899]
25-07-29.22:36:34.833 [main            ] INFO  BehaviorRebateServiceTest - Started BehaviorRebateServiceTest in 4.926 seconds (JVM running for 5.483)
25-07-29.22:36:35.017 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:36:35.147 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:36:35.147 [pool-3-thread-3 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-07-29.22:36:35.233 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:36:35.233 [pool-3-thread-3 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:36:35.234 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-07-29.22:36:35.384 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_sku_2025072909","rebateConfig":"9011","rebateType":"sku","userId":"xiaofuge"},"id":"89685076209","timestamp":1753799795308}
25-07-29.22:36:35.393 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 topic: send_rebate message: {"data":{"bizId":"xiaofuge_sku_2025072909","rebateConfig":"9011","rebateType":"sku","userId":"xiaofuge"},"id":"89685076209","timestamp":1753799795308}
25-07-29.22:36:35.407 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_integral_2025072909","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge"},"id":"04740516350","timestamp":1753799795309}
25-07-29.22:36:35.421 [main            ] INFO  BehaviorRebateServiceTest - 请求参数：{"behaviorTypeVO":"SIGN","outBusinessNo":"2025072909","userId":"xiaofuge"}
25-07-29.22:36:35.428 [main            ] INFO  BehaviorRebateServiceTest - 测试结果：["399411170113","729081228892"]
25-07-29.22:36:35.437 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivityBaseActionChain - 活动责任链-基础信息【有效期、状态、库存(sku)】校验开始。sku:9011 activityId:100301
25-07-29.22:36:35.437 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【校验&扣减】开始。
25-07-29.22:36:35.444 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【有效期、状态、库存（sku）】成功。sku：9011 activityId:100301
25-07-29.22:36:35.527 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  RebateMessageCustomer  - 监听用户行为返利消息 topic: send_rebate message: {"data":{"bizId":"xiaofuge_integral_2025072909","rebateConfig":"10","rebateType":"integral","userId":"xiaofuge"},"id":"04740516350","timestamp":1753799795309}
25-07-29.22:36:35.529 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  CreditAdjustService    - 增加账户积分额度开始 userId:xiaofuge tradeName:REBATE amount:10
25-07-29.22:36:35.572 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  CreditAdjustService    - 增加账户积分额度完成 userId:xiaofuge orderId:348770251334
25-07-29.23:04:00.028 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@69b7b021 (Communications link failure

The last packet successfully received from the server was 5,015 milliseconds ago. The last packet sent successfully to the server was 5,017 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.028 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@22bef9f3 (Communications link failure

The last packet successfully received from the server was 5,015 milliseconds ago. The last packet sent successfully to the server was 5,016 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.030 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@52ce27fc (Communications link failure

The last packet successfully received from the server was 1,644,665 milliseconds ago. The last packet sent successfully to the server was 1,644,666 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.030 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@7f493ddb (Communications link failure

The last packet successfully received from the server was 1,644,666 milliseconds ago. The last packet sent successfully to the server was 1,644,666 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.032 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@2b2bacab (Communications link failure

The last packet successfully received from the server was 1,644,648 milliseconds ago. The last packet sent successfully to the server was 1,644,648 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.032 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@7ea3d37 (Communications link failure

The last packet successfully received from the server was 1,644,647 milliseconds ago. The last packet sent successfully to the server was 1,644,648 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.034 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@5256935a (Communications link failure

The last packet successfully received from the server was 1,644,624 milliseconds ago. The last packet sent successfully to the server was 1,644,626 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.035 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@84c9f9e (Communications link failure

The last packet successfully received from the server was 1,644,624 milliseconds ago. The last packet sent successfully to the server was 1,644,626 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.036 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@47d6b9cc (Communications link failure

The last packet successfully received from the server was 1,644,601 milliseconds ago. The last packet sent successfully to the server was 1,644,603 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.036 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@25b77643 (Communications link failure

The last packet successfully received from the server was 1,644,599 milliseconds ago. The last packet sent successfully to the server was 1,644,601 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.038 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@71c7e308 (Communications link failure

The last packet successfully received from the server was 1,644,583 milliseconds ago. The last packet sent successfully to the server was 1,644,584 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.038 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@66544ce (Communications link failure

The last packet successfully received from the server was 1,644,583 milliseconds ago. The last packet sent successfully to the server was 1,644,584 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.041 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@77f576f (Communications link failure

The last packet successfully received from the server was 1,644,567 milliseconds ago. The last packet sent successfully to the server was 1,644,568 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.041 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@5030c2b0 (Communications link failure

The last packet successfully received from the server was 1,644,567 milliseconds ago. The last packet sent successfully to the server was 1,644,568 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.043 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@61d5c899 (Communications link failure

The last packet successfully received from the server was 1,644,552 milliseconds ago. The last packet sent successfully to the server was 1,644,553 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.043 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@3c6c1747 (Communications link failure

The last packet successfully received from the server was 1,644,551 milliseconds ago. The last packet sent successfully to the server was 1,644,553 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.045 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@5d2e7b6a (Communications link failure

The last packet successfully received from the server was 1,644,538 milliseconds ago. The last packet sent successfully to the server was 1,644,538 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.045 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@e981843 (Communications link failure

The last packet successfully received from the server was 1,644,538 milliseconds ago. The last packet sent successfully to the server was 1,644,538 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.048 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@586b7e62 (Communications link failure

The last packet successfully received from the server was 1,644,523 milliseconds ago. The last packet sent successfully to the server was 1,644,524 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.048 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@20978b8f (Communications link failure

The last packet successfully received from the server was 1,644,522 milliseconds ago. The last packet sent successfully to the server was 1,644,523 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.049 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@6f490e04 (Communications link failure

The last packet successfully received from the server was 1,644,504 milliseconds ago. The last packet sent successfully to the server was 1,644,505 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.049 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@4619c07 (Communications link failure

The last packet successfully received from the server was 1,644,502 milliseconds ago. The last packet sent successfully to the server was 1,644,503 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.049 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@430a4fe (Communications link failure

The last packet successfully received from the server was 1,644,473 milliseconds ago. The last packet sent successfully to the server was 1,644,474 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.050 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@1d50673f (Communications link failure

The last packet successfully received from the server was 1,644,474 milliseconds ago. The last packet sent successfully to the server was 1,644,475 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.050 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@53c42ed6 (Communications link failure

The last packet successfully received from the server was 1,644,454 milliseconds ago. The last packet sent successfully to the server was 1,644,455 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.050 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@2a6b6a39 (Communications link failure

The last packet successfully received from the server was 1,644,454 milliseconds ago. The last packet sent successfully to the server was 1,644,455 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.050 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@50dfd2a2 (Communications link failure

The last packet successfully received from the server was 1,644,436 milliseconds ago. The last packet sent successfully to the server was 1,644,437 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.050 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@36bc5708 (Communications link failure

The last packet successfully received from the server was 1,644,436 milliseconds ago. The last packet sent successfully to the server was 1,644,437 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.050 [pool-3-thread-9 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@5856ed1a (Communications link failure

The last packet successfully received from the server was 1,644,416 milliseconds ago. The last packet sent successfully to the server was 1,644,418 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:00.051 [pool-3-thread-5 ] WARN  PoolBase               - Retail_HikariCP - Failed to validate connection com.mysql.cj.jdbc.ConnectionImpl@112246f5 (Communications link failure

The last packet successfully received from the server was 1,644,417 milliseconds ago. The last packet sent successfully to the server was 1,644,419 milliseconds ago.). Possibly consider using a shorter maxLifetime value.
25-07-29.23:04:10.895 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.23:04:10.897 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.23:04:10.898 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-07-29.23:04:11.262 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.23:04:11.552 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.23:04:11.819 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-07-29.23:04:11.824 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.23:04:11.826 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-07-29.23:04:11.826 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
